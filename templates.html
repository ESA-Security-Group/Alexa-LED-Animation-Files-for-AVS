<!DOCTYPE html>
<html lang="en" data-url="/templates/">
  <head>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','cfDataLayer','GTM-PKQFGQB');</script>
        
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.59.1" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">

    <meta name="author" content="Cloudflare Inc">
    <meta name="twitter:card" content="summary">

    <meta property="og:url" content="/templates/">

    
      
    

    <meta name="description" content="Use Cloudflareâ€™s APIs and edge network to build secure, ultra-fast applications.">
    <meta name="og:description" content="Use Cloudflareâ€™s APIs and edge network to build secure, ultra-fast applications.">
    <meta name="twitter:description" content="Use Cloudflareâ€™s APIs and edge network to build secure, ultra-fast applications.">

    






  

  
    
      
    
  

  
    
  

  

  
    
      
    
  

  
    
  

  

  

  
    
  

  

  

  
    
  

  

  

  
    
  






  
    
  

  
    
  


<script type="application/ld+json">
  "{\"@context\":\"http://schema.org\",\"@type\":\"BreadcrumbList\",\"itemListElement\":[{\"@type\":\"ListItem\",\"item\":{\"@id\":\"https://developers.cloudflare.com/workers/\",\"name\":\"Cloudflare Workers Docs\"},\"position\":1},{\"@type\":\"ListItem\",\"item\":{\"@id\":\"https://developers.cloudflare.com/workers/templates/\",\"name\":\"Template Gallery\"},\"position\":2}]}"
</script>



    

    
      <meta property="og:title" content="Template Gallery - Cloudflare Workers Docs">
      <meta property="twitter:title" content="Template Gallery - Cloudflare Workers Docs">
      <title>Template Gallery - Cloudflare Workers Docs</title>
    

    <script type="text/javascript" src="https://cdn.bizible.com/scripts/bizible.js" async=""></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://developers.cloudflare.com/workers/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://developers.cloudflare.com/workers/css/theme.css" rel="stylesheet">

    <link href="https://developers.cloudflare.com/workers/css/docsearch.min.css" rel="stylesheet">
    <script src="https://developers.cloudflare.com/workers/js/docsearch.min.js"></script>

    <link rel="icon" sizes="32x32" href="https://www.cloudflare.com/img/favicon/favicon-32x32.png">
    <link rel="icon" sizes="16x16" href="https://www.cloudflare.com/img/favicon/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://www.cloudflare.com/img/favicon/apple-touch-icon.png">

    <link href="https://developers.cloudflare.com/workers/css/main.css" rel="stylesheet">
    <link href="https://developers.cloudflare.com/workers/css/overview.css" rel="stylesheet">
    <link href="https://developers.cloudflare.com/workers/css/code.css" rel="stylesheet">
    <link href="https://developers.cloudflare.com/workers/css/template.css" rel="stylesheet">
    <script src="https://developers.cloudflare.com/workers/js/workers.js" ></script>

    
    

  </head>
  <body>
    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKQFGQB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    
<div class="navigation">
  <a href="https://workers.cloudflare.com">
    <div class="logo">
      <svg id="CloudflareWorkersLogoCombinationMarkHorizontal" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1430 375" role="img" aria-labelledby="CloudflareWorkersLogoCombinationMarkHorizontal--title CloudflareWorkersLogoCombinationMarkHorizontal--desc">
        <title id="CloudflareWorkersLogoCombinationMarkHorizontal--title">Cloudflare Workers logo (horizontal)</title>
        <desc id="CloudflareWorkersLogoCombinationMarkHorizontal--desc">The horizontal wordmark logo for the Cloudflare Workers brand.</desc>
        <defs>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-a" x1="50%" x2="25.7%" y1="100%" y2="8.7%">
            <stop offset="0%" stop-color="#eb6f07"></stop>
            <stop offset="100%" stop-color="#fab743"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-b" x1="81%" x2="40.5%" y1="83.7%" y2="29.5%">
            <stop offset="0%" stop-color="#d96504"></stop>
            <stop offset="100%" stop-color="#d96504" stop-opacity="0"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-c" x1="42%" x2="84%" y1="8.7%" y2="79.9%">
            <stop offset="0%" stop-color="#eb6f07"></stop>
            <stop offset="100%" stop-color="#eb720a" stop-opacity="0"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-d" x1="50%" x2="25.7%" y1="100%" y2="8.7%">
            <stop offset="0%" stop-color="#ee6f05"></stop>
            <stop offset="100%" stop-color="#fab743"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-e" x1="-33.2%" x2="91.7%" y1="100%" y2="0%">
            <stop offset="0%" stop-color="#d96504" stop-opacity=".8"></stop>
            <stop offset="49.8%" stop-color="#d96504" stop-opacity=".2"></stop>
            <stop offset="100%" stop-color="#d96504" stop-opacity="0"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-f" x1="50%" x2="25.7%" y1="100%" y2="8.7%">
            <stop offset="0%" stop-color="#ffa95f"></stop>
            <stop offset="100%" stop-color="#ffebc8"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-g" x1="8.1%" x2="96.5%" y1="1.1%" y2="48.8%">
            <stop offset="0%" stop-color="#fff" stop-opacity=".5"></stop>
            <stop offset="100%" stop-color="#fff" stop-opacity=".1"></stop>
          </linearGradient>
          <linearGradient id="CloudflareWorkersLogoCombinationMarkHorizontal--gradient-h" x1="-13.7%" y1="104.2%" y2="46.2%">
            <stop offset="0%" stop-color="#fff" stop-opacity=".5"></stop>
            <stop offset="100%" stop-color="#fff" stop-opacity=".1"></stop>
          </linearGradient>
        </defs>
        <path fill="currentColor" d="M553.2 320.1L500.6 165h36.3l31.9 104.3 34.5-104.7h29L667 269.3 699 165h35.3l-52.5 155.1h-29.5l-34.8-100.8-34.7 100.8h-29.5zm246.2 1.5c-36.6 0-63.6-27-63.6-60.9v-.4c0-34 27.3-61.4 64-61.4 36.5 0 63.6 27 63.6 61v.4c0 33.8-27.3 61.3-64 61.3zm.4-28.8c19.1 0 30.6-14.7 30.6-32.1v-.4c0-17.4-12.6-32.6-31-32.6-19.2 0-30.6 14.7-30.6 32.1v.5c0 17.3 12.5 32.5 31 32.5zm87.8 26.2V201H921v23.8c6.8-16.2 17.8-26.8 37.6-26v35H957c-22.2 0-35.9 13.5-35.9 41.6V319h-33.4zm92 0V158.4h33.4V244l39.1-43h40l-44.8 46.5 46.4 71.5h-38.3l-30.8-48.2-11.6 12.3V319h-33.5zm180.6 2.6c-35.5 0-61.6-24.8-61.6-60.9v-.4c0-33.7 24-61.4 58.3-61.4 39.3 0 57.4 30.6 57.4 64 0 2.6-.2 5.7-.5 8.8h-82c3.3 15.2 13.8 23.1 28.8 23.1 11.2 0 19.4-3.5 28.6-12.1l19.1 17a59 59 0 0 1-48.1 22zm-28.9-70.8h50.4c-2-15-10.8-25-24.8-25-13.9 0-23 9.8-25.6 25zm107.8 68.2V201h33.5v23.8c6.8-16.2 17.8-26.8 37.6-26v35h-1.8c-22.2 0-35.8 13.5-35.8 41.6V319H1239zm133.4 2.2c-16.5 0-35-5.5-50.6-17.8l14.3-22a66.7 66.7 0 0 0 37.1 14c9.7 0 14.1-3.5 14.1-8.7v-.5c0-7.2-11.4-9.7-24.4-13.6-16.5-4.9-35.2-12.6-35.2-35.4v-.5c0-24 19.4-37.4 43.1-37.4 15 0 31.3 5 44 13.7l-12.7 23a69.9 69.9 0 0 0-32-11c-8 0-12.3 3.6-12.3 8.2v.4c0 6.6 11.3 9.7 24 14.1 16.5 5.5 35.7 13.4 35.7 35v.4c0 26.2-19.6 38.1-45.1 38.1z"></path>
        <path fill="currentColor" d="M1210.9 78.9a6 6 0 1 1 0-12.1c3.3 0 6.1 2.7 6.1 6s-2.8 6-6.1 6zm0-11a4.9 4.9 0 0 0-4.9 5c0 2.6 2.2 4.8 4.9 4.8s4.9-2.2 4.9-4.9c0-2.6-2.2-4.8-4.9-4.8zm3.1 8.1h-1.4l-1.2-2.3h-1.6V76h-1.3v-6.6h3.2c1.4 0 2.3.9 2.3 2.1a2 2 0 0 1-1.4 2l1.4 2.5zm-2.4-3.5c.5 0 1-.3 1-1s-.4-1-1-1h-2v2h2zm-636.5-6.3h15.6v42.1H618v13.5H575V66.2zm58.9 28V94c0-16 13-29 30.3-29a29 29 0 0 1 30 28.8v.2c0 16-13 28.9-30.2 28.9A29 29 0 0 1 634 94.1zm44.6 0V94c0-8-5.8-15-14.4-15-8.5 0-14.2 6.8-14.2 14.9v.1c0 8 5.8 15 14.3 15 8.6 0 14.3-6.8 14.3-14.9zm34.9 3.2V66.2h15.8v31c0 8 4.1 11.7 10.3 11.7 6.2 0 10.3-3.6 10.3-11.4V66.2h15.8V97c0 18-10.3 25.8-26.3 25.8s-26-8-26-25.4zm76-31.2h21.6c20 0 31.7 11.4 31.7 27.5v.2c0 16-11.8 28-32 28h-21.3V66.1zm22 42c9.2 0 15.4-5.1 15.4-14.2V94c0-9-6.2-14.1-15.5-14.1h-6.3V108h6.3v.1zm54-42h44.9v13.5H881v9.5h26.6V102H881v19.8h-15.5V66.2zm66.5 0h15.5v42.1h27.2v13.5H932V66.2zm83.3-.4h15l24 56h-16.8l-4-9.9h-21.7l-4 10h-16.3l23.8-56.1zm13.7 34.1l-6.2-15.8-6.3 15.8h12.5zm45.2-33.7h26.6c8.6 0 14.5 2.2 18.3 6 3.3 3.2 5 7.5 5 13v.2c0 8.6-4.6 14.2-11.5 17L1126 122h-18l-11.4-16.8h-6.8v16.8h-15.6V66.2zm25.9 26.7c5.3 0 8.3-2.6 8.3-6.6v-.2c0-4.3-3.2-6.5-8.4-6.5h-10.3v13.3h10.4zm46.4-26.7h45v13H1162v8.5h26.9v12.2h-27v8.8h30.2v13.1h-45.5V66.2zM541 100.7a13.8 13.8 0 0 1-12.8 8.3c-8.5 0-14.3-7-14.3-15V94c0-8 5.7-15 14.2-15a14 14 0 0 1 13.3 9.3H558a29.2 29.2 0 0 0-29.6-23.1c-17.3 0-30.3 13-30.3 29v.1a29 29 0 0 0 30.1 28.8c14.8 0 26.4-9.5 29.4-22.2l-16.4-.1z" opacity=".6"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-a)" d="M107 5.4l49 88.4-45 81a26 26 0 0 0 0 25.3l45 81.2-49 88.4A52 52 0 0 1 85 349L7 213.5a52.2 52.2 0 0 1 0-52L85 26a52 52 0 0 1 22-20.6z"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-b)" d="M111 174.9a26 26 0 0 0 0 25.2l45 81.2-49 88.4A52 52 0 0 1 85 349L7 213.5C.8 202.8 35.5 190 111 175z" opacity=".7"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-c)" d="M112 14.3l44 79.5-7.3 12.7-38.8-65.7C98.7 22.5 81.6 32 60.2 69l3.2-5.5L85 26a52 52 0 0 1 21.8-20.6l5.1 8.9z" opacity=".5"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-d)" d="M331 26l78 135.5c9.3 16 9.3 36 0 52L331 349a52 52 0 0 1-45 26h-78l97-174.9a26 26 0 0 0 0-25.2L208 0h78a52 52 0 0 1 45 26z"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-e)" d="M282 374.4l-77 .7 93.2-175.8a27 27 0 0 0 0-25.4L205 0h17.6l97.8 173.1a27 27 0 0 1-.1 26.8 15624 15624 0 0 0-62.7 110c-19 33.4-10.8 54.9 24.4 64.5z"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-f)" d="M130 375c-8 0-16-1.9-23-5.3l96.2-173.5c3-5.4 3-12 0-17.4L107 5.4A52 52 0 0 1 130 0h78l97 174.9a26 26 0 0 1 0 25.2L208 375h-78z"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-g)" d="M298.2 178.8L199 0h9l97 174.9a26 26 0 0 1 0 25.2L208 375h-9l99.2-178.8c3-5.4 3-12 0-17.4z" opacity=".6"></path>
        <path fill="url(#CloudflareWorkersLogoCombinationMarkHorizontal--gradient-h)" d="M203.2 178.8L107 5.4c3-1.6 6.6-2.8 10-3.8 21.2 38.1 52.5 95.9 94 173.3a26 26 0 0 1 0 25.2L115.5 373c-3.4-1-5.2-1.7-8.4-3.2l96-173.5c3-5.4 3-12 0-17.4z" opacity=".6"></path>
      </svg>
    </div>
  </a>
  <a href="https://developers.cloudflare.com/workers/" class="active navigation-link"><strong>Docs</strong></a>
  <a href="https://developers.cloudflare.com/workers/quickstart/" class="navigation-link"><span>Quick&nbsp;Start</span></a>
  <a href="https://developers.cloudflare.com/workers/templates/" class="navigation-link"><span>Templates</span></a>
  <a href="https://developers.cloudflare.com/workers/tutorials/" class="navigation-link"><span>Tutorials</span></a>
  <a href="https://developers.cloudflare.com/workers/reference/" class="navigation-link"><span>Reference</span></a>
  <a href="https://developers.cloudflare.com/workers/tooling/" class="navigation-link"><span>Tooling</span></a>
  <a href="https://developers.cloudflare.com/workers/about/" class="navigation-link"><span>About</span></a>
</div>

<script>
  Array.prototype.forEach.call(document.querySelectorAll('.navigation-link'), function(link) {
    if (link.pathname === location.pathname || location.pathname.indexOf(link.pathname) === 0) {
      document.querySelector('.navigation a.active').removeAttribute('class');
      link.className = 'active';
    }
  });
</script>

<a id="sidebar-toggle"><span><b></b><b></b><b></b></span></a>
<script>
  document.querySelector('#sidebar-toggle').addEventListener('click', function(){
    if (document.body.classList.contains('with-sidebar-open')) {
      document.body.classList.remove('with-sidebar-open');
    } else {
      document.body.classList.add('with-sidebar-open');
    }
  });
</script>

<div id="sidebar-open-backdrop"></div>
<nav id="sidebar">
  <div class="search-container">
    <input
      class="search-input"
      type="text"
      id="docsearch-input"
      placeholder="Search the docs..."
    />
  </div>

  
  <div class="highlightable">
    <ul class="topics">
        
          <li data-nav-id="/" class="docs-nav-item-header">
            <a class="" href="https://developers.cloudflare.com/workers/" title="Docs Home">
              
                Overview
              
            </a>
          </li>
        

        
          
          

 
  
   
     
     <li data-nav-id="/quickstart/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/quickstart/">
         <span>Quick Start</span>

         

         
         
       </a>
       
     </li>
   
  
 

          
          

 
  
   
     
     <li data-nav-id="/templates/" class="dd-item
         parent
         active
         parent
         always-open
         ">
       <a href="https://developers.cloudflare.com/workers/templates/">
         <span>Template Gallery</span>

         

         
         

           
             <i class="triangle-up"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
             
             
           
         
         </ul>
       
     </li>
   
  
 

          
          

 
  
   
     
     <li data-nav-id="/tutorials/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/">
         <span>Tutorials</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           
           
           

         
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/build-an-application/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/build-an-application/">
         <span>Build an Application</span>

         

         
         
       </a>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/build-a-todo-list/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/build-a-todo-list/">
         <span>Build A To-Do List With KV</span>

         

         
         
       </a>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/build-a-serverless-function/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/build-a-serverless-function/">
         <span>Build a Serverless Function</span>

         

         
         
       </a>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/configure-your-cdn/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/configure-your-cdn/">
         <span>Configure Your CDN</span>

         

         
         
       </a>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/deploy-a-react-app/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/deploy-a-react-app/">
         <span>Deploy a React App</span>

         
           <span class="new-badge">NEW</span>
         

         
         
       </a>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/hosting-static-wordpress-sites/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/hosting-static-wordpress-sites/">
         <span>Hosting Static Wordpress Sites</span>

         

         
         
       </a>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tutorials/localize-a-website/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tutorials/localize-a-website/">
         <span>Localize a Website</span>

         
           <span class="new-badge">NEW</span>
         

         
         
       </a>
       
     </li>
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

          
          

 
  
   
     
     <li data-nav-id="/sites/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/sites/">
         <span>Workers Sites</span>

         
           <span class="new-badge">NEW</span>
         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/sites/start-from-scratch/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/sites/start-from-scratch/">
         <span>Start from Scratch</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/sites/start-from-existing/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/sites/start-from-existing/">
         <span>Start from an Existing Site</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/sites/start-from-worker/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/sites/start-from-worker/">
         <span>Start from an Existing Worker</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

          
          

 
  
   
     
     <li data-nav-id="/tooling/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tooling/">
         <span>Tooling</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           
           
           

         
           
             
             

 
  
   
     
     <li data-nav-id="/tooling/wrangler/" class="dd-item
         
         
         parent
         always-open
         ">
       <a href="https://developers.cloudflare.com/workers/tooling/wrangler/">
         <span>Wrangler CLI</span>

         
           <span class="new-badge">NEW</span>
         

         
         

           
             <i class="triangle-up"></i>
           

         
       </a>
       
         <ul>
           
           
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/wrangler/install/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/wrangler/install/">
         <span>Install</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/wrangler/commands/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/wrangler/commands/">
         <span>Commands</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tooling/wrangler/configuration/" class="dd-item
         
         
         parent
         always-open
         ">
       <a href="https://developers.cloudflare.com/workers/tooling/wrangler/configuration/">
         <span>Configuration</span>

         

         
         

           
             <i class="triangle-up"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/wrangler/configuration/environments/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/wrangler/configuration/environments/">
         <span>Environments</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/wrangler/webpack/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/wrangler/webpack/">
         <span>Webpack</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/wrangler/kv_commands/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/wrangler/kv_commands/">
         <span>KV</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/wrangler/sites/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/wrangler/sites/">
         <span>Sites</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/playground/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/playground/">
         <span>Playground</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/tooling/api/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/tooling/api/">
         <span>REST API</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/api/requests/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/api/requests/">
         <span>Making Requests</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/api/scripts/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/api/scripts/">
         <span>Scripts</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/api/bindings/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/api/bindings/">
         <span>Bindings</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/api/routes/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/api/routes/">
         <span>Routes</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/serverless/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/serverless/">
         <span>Serverless Plugin</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/terraform/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/terraform/">
         <span>Terraform</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/tooling/integrations/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/tooling/integrations/">
         <span>Integrations</span>
         
           <span class="new-badge">NEW</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

          
          

 
  
   
     
     <li data-nav-id="/about/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/about/">
         <span>About</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/about/how-it-works/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/how-it-works/">
         <span>How It Works</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/security/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/security/">
         <span>Security</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/using-cache/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/using-cache/">
         <span>Using the Cache</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/limits/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/limits/">
         <span>Limits</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/pricing/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/pricing/">
         <span>Pricing</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/routes/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/routes/">
         <span>Routes</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/about/tips/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/about/tips/">
         <span>Tips</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/about/tips/debugging/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/tips/debugging/">
         <span>Debugging Tips</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/tips/headers/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/tips/headers/">
         <span>Logging Headers</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/tips/signing-requests/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/tips/signing-requests/">
         <span>Signing Requests</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/tips/fetch-event-lifecycle/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/tips/fetch-event-lifecycle/">
         <span>The FetchEvent Lifecycle</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/about/tips/request-context/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/about/tips/request-context/">
         <span>The Request Context</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

          
          

 
  
   
     
     <li data-nav-id="/reference/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/reference/">
         <span>Reference</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           
           
           

         
           
             
             

 
  
   
     
     <li data-nav-id="/reference/apis/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/reference/apis/">
         <span>Runtime APIs</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/standard/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/standard/">
         <span>Web Standards</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/fetch/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/fetch/">
         <span>fetch</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/fetch-event/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/fetch-event/">
         <span>fetchEvent</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/reference/apis/configuration_variables/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/reference/apis/configuration_variables/">
         <span>Configuration Variables</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/configuration_variables/kv/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/configuration_variables/kv/">
         <span>KV</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/request/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/request/">
         <span>Request</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/response/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/response/">
         <span>Response</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/streams/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/streams/">
         <span>Streams</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/encoding/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/encoding/">
         <span>Encoding</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/web-crypto/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/web-crypto/">
         <span>Web Crypto</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/cache/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/cache/">
         <span>Cache API</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/apis/html-rewriter/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/apis/html-rewriter/">
         <span>HTMLRewriter</span>
         
           <span class="new-badge">NEW</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
             
             

 
  
   
     
     <li data-nav-id="/reference/storage/" class="dd-item
         
         
         
         
         ">
       <a href="https://developers.cloudflare.com/workers/reference/storage/">
         <span>Workers KV</span>

         

         
         

           
             <i class="triangle-down"></i>
           

         
       </a>
       
         <ul>
           
           
           

         
           
             
             

 
  
   
     
       <li data-nav-id="/reference/storage/use-cases/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/storage/use-cases/">
         <span>Use cases</span>
         

         </a></li>
      
   
  
 

             
           
             
             

 
  
   
     
       <li data-nav-id="/reference/storage/namespaces/" class="dd-item
      
       ">
         <a href="https://developers.cloudflare.com/workers/reference/storage/namespaces/">
         <span>Namespaces</span>
         

         </a></li>
      
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

             
           
         
         </ul>
       
     </li>
   
  
 

          
          

 
  
 

          
        
    </ul>
  </div>
</nav>




<script type="text/javascript">
  docsearch({
    apiKey: '4a3bbdb939606486b94f9ce867bfd4f5',
    indexName: 'workers-cloudflare',
    inputSelector: '#docsearch-input'
  });
</script>


<section id="body">
  <div class="padding highlightable">
    
    

    <div id="body-inner">
      
      <h1>Template Gallery</h1>
      


      <p>These templates are simple building blocks for developing Workers scripts.</p>

<div style="display: flex">
  <div style="flex: 2; margin-right: 16px;">
    <label style="font-weight: normal; color: #666;">Search templates</label>
    <input id="search" placeholder="ðŸ”Ž Search by template name or other details" style="padding: 10px; width: 100%"></input>
  </div>
  <div style="flex: 1; margin-right: 16px;">
    <label style="font-weight: normal; color: #666;">Type</label>
    <select id="type" style="width: 100%">
      <option>All</option>
      <option>Boilerplates</option>
      <option>Snippets</option>
      <option value="featured_boilerplates">Featured</option>
    </select>
  </div>
</div>

<div id="empty" style="display: none; margin-top: 20px;">
<p>No results were found for your search. Try adjusting your search.</p>
</div>

<div class="gallery" id="results">
  
  
  
  
  
  
  <h2 style="padding-bottom: 20px">Boilerplates</h2>
  <section class="template-wrapper boilerplates">
    
    <div class="template_result" id="hello_world">
      <figure class="template-card boilerplate" id="hello_world">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/hello_world>
    <h2>
      Hello World
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Simple Hello World in JS</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/cloudflare/worker-template">https://github.com/cloudflare/worker-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    <script type="application/json" id="boilerplates">
      {"demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#6626eb50f7b53c2d42b79d1082b9bd37:https://tutorial.cloudflareworkers.com"}},"description":"Simple Hello World in JS","id":"hello_world","repository_url":"https://github.com/cloudflare/worker-template","title":"Hello World","type":"boilerplate","weight":99}
    </script>
    
    <div class="template_result" id="hello_world_rust">
      <figure class="template-card boilerplate" id="hello_world_rust">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/hello_world_rust>
    <h2>
      Hello World Rust
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Simple Hello World in Rust</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/cloudflare/rustwasm-worker-template">https://github.com/cloudflare/rustwasm-worker-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    <script type="application/json" id="boilerplates">
      {"demos":{"main":{"share_url":"/templates/boilerplates/rustwasm","tags":["Originless","Wasm"],"text":"Demo","url":"https://cloudflareworkers.com/#1992963c14c25bc8dc4c50f4cab740e5:https://tutorial.cloudflareworkers.com"}},"description":"Simple Hello World in Rust","id":"hello_world_rust","repository_url":"https://github.com/cloudflare/rustwasm-worker-template","title":"Hello World Rust","type":"boilerplate","weight":98}
    </script>
    
    <div class="template_result" id="router">
      <figure class="template-card boilerplate" id="router">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/router>
    <h2>
      Router
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Selects the logic based on the <code>request</code> method and URL. Use with REST APIs or apps that require routing logic.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/cloudflare/worker-template-router">https://github.com/cloudflare/worker-template-router</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    <script type="application/json" id="boilerplates">
      {"demos":{"bar":{"text":"Demo /bar","url":"https://cloudflareworkers.com/#6cbbd3ae7d4e928da3502cb9ce11227a:https://tutorial.cloudflareworkers.com/bar"},"foo":{"text":"Demo /foo","url":"https://cloudflareworkers.com/#6cbbd3ae7d4e928da3502cb9ce11227a:https://tutorial.cloudflareworkers.com/foo"}},"description":"Selects the logic based on the `request` method and URL. Use with REST APIs or apps that require routing logic.","id":"router","repository_url":"https://github.com/cloudflare/worker-template-router","share_url":"/templates/boilerplates/router","title":"Router","type":"boilerplate","url":"/templates/boilerplates/router","weight":97}
    </script>
    
    <div class="template_result" id="typescript">
      <figure class="template-card boilerplate" id="typescript">
  <div class="tag-group">
    
    <button class="tooltip Originless">
      <span class="tooltiptext"></span>Originless
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/typescript>
    <h2>
      Hello World TypeScript
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Simple Hello World in TypeScript</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/EverlastingBugstopper/worker-typescript-template">https://github.com/EverlastingBugstopper/worker-typescript-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    <script type="application/json" id="boilerplates">
      {"description":"Simple Hello World in TypeScript","id":"typescript","repository_url":"https://github.com/EverlastingBugstopper/worker-typescript-template","tags":["Originless"],"title":"Hello World TypeScript","type":"boilerplate","weight":90}
    </script>
    
  </section>
  
  
  <h2 style="padding-bottom: 20px">Snippets</h2>
  <section class="template-wrapper snippet">
    
    <figure class="template-card snippet" id="conditional_response">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/conditional_response>
    <h2>
      Conditional Response
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Return a response based on the incoming request&rsquo;s URL, HTTP method, User Agent, IP address, ASN or device type (e.g. mobile)</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>const BLOCKED_HOSTNAMES = [&#39;nope.mywebsite.com&#39;, &#39;bye.website.com&#39;]
async function handleRequest(request) {
  // Return a new Response based on..
  // On URL&#39;s hostname
  let url = new URL(request.url)
  if (BLOCKED_HOSTNAMES.includes(url.hostname)) {
    return new Response(&#39;Blocked Host&#39;, { status: 403 })
  }
  // On URL&#39;s file extenstion (e.g. block paths ending in .doc or .xml)
  let forbiddenExtRegExp = new RegExp(/\.(doc|xml)$/)
  if (forbiddenExtRegExp.test(url.pathname)) {
    return new Response(&#39;Blocked Extension&#39;, { status: 403 })
  }
  // On HTTP method
  if (request.method === &#39;POST&#39;) {
    return new Response(&#39;Response for POST&#39;)
  }
  // On User Agent
  let userAgent = request.headers.get(&#39;User-Agent&#39;) || &#39;&#39;
  if (userAgent.includes(&#39;bot&#39;)) {
    return new Response(&#39;Block User Agent containing bot&#39;, { status: 403 })
  }
  // On Client&#39;s IP address
  let clientIP = request.headers.get(&#39;CF-Connecting-IP&#39;)
  if (clientIP === &#39;1.2.3.4&#39;) {
    return new Response(&#39;Block the IP 1.2.3.4&#39;, { status: 403 })
  }
  // On ASN
  if ((request.cf || {}).asn == 64512) {
    return new Response(&#39;Block the ASN 64512 response&#39;)
  }
  // On Device Type
  //  Requires Enterprise &#34;CF-Device-Type Header&#34; zone setting or
  //  Page Rule with &#34;Cache By Device Type&#34; setting applied.
  let device = request.headers.get(&#39;CF-Device-Type&#39;)
  if (device === &#39;mobile&#39;) {
    return Response.redirect(&#39;https://mobile.example.com&#39;)
  }
  console.error(
    &#34;Getting Client&#39;s IP address, device type, and ASN are not supported in playground. Must test on a live worker&#34;,
  )
  return fetch(request)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"const BLOCKED_HOSTNAMES = ['nope.mywebsite.com', 'bye.website.com']\nasync function handleRequest(request) {\n  // Return a new Response based on..\n  // On URL's hostname\n  let url = new URL(request.url)\n  if (BLOCKED_HOSTNAMES.includes(url.hostname)) {\n    return new Response('Blocked Host', { status: 403 })\n  }\n  // On URL's file extenstion (e.g. block paths ending in .doc or .xml)\n  let forbiddenExtRegExp = new RegExp(/\\.(doc|xml)$/)\n  if (forbiddenExtRegExp.test(url.pathname)) {\n    return new Response('Blocked Extension', { status: 403 })\n  }\n  // On HTTP method\n  if (request.method === 'POST') {\n    return new Response('Response for POST')\n  }\n  // On User Agent\n  let userAgent = request.headers.get('User-Agent') || ''\n  if (userAgent.includes('bot')) {\n    return new Response('Block User Agent containing bot', { status: 403 })\n  }\n  // On Client's IP address\n  let clientIP = request.headers.get('CF-Connecting-IP')\n  if (clientIP === '1.2.3.4') {\n    return new Response('Block the IP 1.2.3.4', { status: 403 })\n  }\n  // On ASN\n  if ((request.cf || {}).asn == 64512) {\n    return new Response('Block the ASN 64512 response')\n  }\n  // On Device Type\n  //  Requires Enterprise \"CF-Device-Type Header\" zone setting or\n  //  Page Rule with \"Cache By Device Type\" setting applied.\n  let device = request.headers.get('CF-Device-Type')\n  if (device === 'mobile') {\n    return Response.redirect('https://mobile.example.com')\n  }\n  console.error(\n    \"Getting Client's IP address, device type, and ASN are not supported in playground. Must test on a live worker\",\n  )\n  return fetch(request)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"share_url":"/templates/snippets/conditional_response","tags":["Enterprise"],"text":"Demo","url":"https://cloudflareworkers.com/#cec6695f67232bc76e3f396fcb2d5cc7:https://nope.mywebsite.com/"}},"description":"Return a response based on the incoming request's URL, HTTP method, User Agent, IP address, ASN or device type (e.g. mobile)","id":"conditional_response","title":"Conditional Response","type":"snippet","weight":60}
    </script>
    
    <figure class="template-card snippet" id="debugging_tips">
  <div class="tag-group">
    
    <button class="tooltip Middleware">
      Middleware
      <span class="tooltiptext"></span>
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/debugging_tips>
    <h2>
      Debugging Tips
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Send debug information in an errored response and to a logging service.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>const LOG_URL = &#39;https://log-service.example.com/&#39; // Service setup up to receive logs
async function handleRequest(event) {
  let response
  try {
    response = await fetch(event.request)
    if (!response.ok) {
      let body = await response.text()
      throw new Error(
        &#39;Bad response at origin. Status: &#39; &#43;
          response.status &#43;
          &#39; Body: &#39; &#43;
          body.trim().substring(0, 10), //ensures is string that can be a header
      )
    }
  } catch (err) {
    // Without event.waitUntil(), our fetch() to our logging service may
    // or may not complete.
    event.waitUntil(postLog(err))
    const stack = JSON.stringify(err.stack) || err
    // Copy the response and initialize body to the stack trace
    response = new Response(stack, response)
    // Shove our rewritten URL into a header to find out what it was.
    response.headers.set(&#39;X-Debug-stack&#39;, stack)
    response.headers.set(&#39;X-Debug-err&#39;, err)
  }
  return response
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  //Have any uncaught errors thrown go directly to origin
  event.passThroughOnException()
  event.respondWith(handleRequest(event))
})
function postLog(data) {
  return fetch(LOG_URL, {
    method: &#39;POST&#39;,
    body: data,
  })
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"const LOG_URL = 'https://log-service.example.com/' // Service setup up to receive logs\nasync function handleRequest(event) {\n  let response\n  try {\n    response = await fetch(event.request)\n    if (!response.ok) {\n      let body = await response.text()\n      throw new Error(\n        'Bad response at origin. Status: ' +\n          response.status +\n          ' Body: ' +\n          body.trim().substring(0, 10), //ensures is string that can be a header\n      )\n    }\n  } catch (err) {\n    // Without event.waitUntil(), our fetch() to our logging service may\n    // or may not complete.\n    event.waitUntil(postLog(err))\n    const stack = JSON.stringify(err.stack) || err\n    // Copy the response and initialize body to the stack trace\n    response = new Response(stack, response)\n    // Shove our rewritten URL into a header to find out what it was.\n    response.headers.set('X-Debug-stack', stack)\n    response.headers.set('X-Debug-err', err)\n  }\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  //Have any uncaught errors thrown go directly to origin\n  event.passThroughOnException()\n  event.respondWith(handleRequest(event))\n})\nfunction postLog(data) {\n  return fetch(LOG_URL, {\n    method: 'POST',\n    body: data,\n  })\n}\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#5601380cdcb173e5b712bd82113ce47a:https://blah.workers-tooling.cf/fetch/error"}},"description":"Send debug information in an errored response and to a logging service.","id":"debugging_tips","share_url":"/about/tips/debugging","tags":["Middleware"],"title":"Debugging Tips","type":"snippet","weight":50}
    </script>
    
    <figure class="template-card snippet" id="send_raw_json">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/send_raw_json>
    <h2>
      Send Raw JSON
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Renders a response of type <code>application/json</code> to the client</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const init = {
    headers: {
      &#39;content-type&#39;: &#39;application/json;charset=UTF-8&#39;,
    },
  }
  return new Response(JSON.stringify(someJSON), init)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
const someJSON = {
  result: [&#39;some&#39;, &#39;results&#39;],
  errors: null,
  msg: &#39;this is some random json&#39;,
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': 'application/json;charset=UTF-8',\n    },\n  }\n  return new Response(JSON.stringify(someJSON), init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\nconst someJSON = {\n  result: ['some', 'results'],\n  errors: null,\n  msg: 'this is some random json',\n}\n","demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#83bc6debecf1dd443d3fabfbde0d2b3a:https://example.com"}},"description":"Renders a response of type `application/json` to the client","id":"send_raw_json","title":"Send Raw JSON","type":"snippet","weight":50}
    </script>
    
    <figure class="template-card snippet" id="fetch_json">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/fetch_json>
    <h2>
      Fetch JSON
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Sends a GET request and reads in JSON from the response.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const init = {
    headers: {
      &#39;content-type&#39;: type,
    },
  }
  const responses = await Promise.all([fetch(url1, init), fetch(url2, init)])
  const results = await Promise.all([gatherResponse(responses[0]), gatherResponse(responses[1])])
  return new Response(results, init)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
/**
 * gatherResponse awaits and returns a response body as a string.
 * Use await gatherResponse(..) in an async function to get the response body
 * @param {Response} response
 */
async function gatherResponse(response) {
  const { headers } = response
  const contentType = headers.get(&#39;content-type&#39;)
  if (contentType.includes(&#39;application/json&#39;)) {
    return await response.json()
  } else if (contentType.includes(&#39;application/text&#39;)) {
    return await response.text()
  } else if (contentType.includes(&#39;text/html&#39;)) {
    return await response.text()
  } else {
    return await response.text()
  }
}
/**
 * Example someHost is set up to return JSON responses
 * Replace url1 and url2  with the hosts you wish to
 * send requests to
 * @param {string} url the URL to send the request to
 */
const someHost = &#39;https://workers-tooling.cf/demos&#39;
const url1 = someHost &#43; &#39;/requests/json&#39;
const url2 = someHost &#43; &#39;/requests/json&#39;
const type = &#39;application/json;charset=UTF-8&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': type,\n    },\n  }\n  const responses = await Promise.all([fetch(url1, init), fetch(url2, init)])\n  const results = await Promise.all([gatherResponse(responses[0]), gatherResponse(responses[1])])\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost is set up to return JSON responses\n * Replace url1 and url2  with the hosts you wish to\n * send requests to\n * @param {string} url the URL to send the request to\n */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url1 = someHost + '/requests/json'\nconst url2 = someHost + '/requests/json'\nconst type = 'application/json;charset=UTF-8'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#a45261f6682b048d9ed0e23a330d9cdb:https://example.com"}},"description":"Sends a GET request and reads in JSON from the response.","id":"fetch_json","title":"Fetch JSON","type":"snippet","weight":30}
    </script>
    
    <figure class="template-card snippet" id="country_code">
  <div class="tag-group">
    
    <button class="tooltip Originless">
      Originless
      <span class="tooltiptext"></span>
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/country_code>
    <h2>
      Country Code
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Redirect a response based on the country code of the visitor</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  return redirect(request, &#39;subdomain&#39;)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * Returns a redirect determined by the country code
 * @param {Request} request
 */
function redirect(request) {
  // The `cf-ipcountry` header is not supported in the previewer
  const country = request.headers.get(&#39;cf-ipcountry&#39;)
  const url = countryMap[country]
  return Response.redirect(url)
}
/**
 * A map of the url&#39;s to redirect to
 * @param {Object} countryMap
*/
const countryMap = {
  &#34;US&#34; : &#34;https://example.com/us&#34;,
  &#34;EU&#34;: &#34;https://eu.example.com/&#34;
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  return redirect(request, 'subdomain')\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Returns a redirect determined by the country code\n * @param {Request} request\n */\nfunction redirect(request) {\n  // The `cf-ipcountry` header is not supported in the previewer\n  const country = request.headers.get('cf-ipcountry')\n  const url = countryMap[country]\n  return Response.redirect(url)\n}\n/**\n * A map of the url's to redirect to\n * @param {Object} countryMap\n*/\nconst countryMap = {\n  \"US\" : \"https://example.com/us\",\n  \"EU\": \"https://eu.example.com/\"\n}\n","description":"Redirect a response based on the country code of the visitor","id":"country_code","tags":["Originless"],"title":"Country Code","type":"snippet","weight":20}
    </script>
    
    <figure class="template-card snippet" id="aggregate_requests">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/aggregate_requests>
    <h2>
      Aggregate Requests
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Sends two GET request to two urls and aggregates the responses into one response.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const init = {
    headers: {
      &#39;content-type&#39;: type,
    },
  }
  const responses = await Promise.all([fetch(url1, init), fetch(url2, init)])
  const results = await Promise.all([gatherResponse(responses[0]), gatherResponse(responses[1])])
  return new Response(results, init)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
/**
 * gatherResponse awaits and returns a response body as a string.
 * Use await gatherResponse(..) in an async function to get the response body
 * @param {Response} response
 */
async function gatherResponse(response) {
  const { headers } = response
  const contentType = headers.get(&#39;content-type&#39;)
  if (contentType.includes(&#39;application/json&#39;)) {
    return await response.json()
  } else if (contentType.includes(&#39;application/text&#39;)) {
    return await response.text()
  } else if (contentType.includes(&#39;text/html&#39;)) {
    return await response.text()
  } else {
    return await response.text()
  }
}
/**
 * Example someHost is set up to return JSON responses
 * Replace url1 and url2  with the hosts you wish to
 * send requests to
 * @param {string} url the URL to send the request to
 */
const someHost = &#39;https://workers-tooling.cf/demos&#39;
const url1 = someHost &#43; &#39;/requests/json&#39;
const url2 = someHost &#43; &#39;/requests/json&#39;
const type = &#39;application/json;charset=UTF-8&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': type,\n    },\n  }\n  const responses = await Promise.all([fetch(url1, init), fetch(url2, init)])\n  const results = await Promise.all([gatherResponse(responses[0]), gatherResponse(responses[1])])\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost is set up to return JSON responses\n * Replace url1 and url2  with the hosts you wish to\n * send requests to\n * @param {string} url the URL to send the request to\n */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url1 = someHost + '/requests/json'\nconst url2 = someHost + '/requests/json'\nconst type = 'application/json;charset=UTF-8'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#eaaa52283784c21aec989c64b9db32d3:https://example.com"}},"description":"Sends two GET request to two urls and aggregates the responses into one response.","id":"aggregate_requests","share_url":"/templates/snippets/aggregate_requests","title":"Aggregate Requests","type":"snippet","weight":20}
    </script>
    
    <figure class="template-card snippet" id="fetch_html">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/fetch_html>
    <h2>
      Fetch HTML
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Sends a request to a remote server, reads HTML from the response, then serves that HTML.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const init = {
    headers: {
      &#39;content-type&#39;: &#39;text/html;charset=UTF-8&#39;,
    },
  }
  const response = await fetch(url, init)
  const results = await gatherResponse(response)
  return new Response(results, init)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
/**
 * gatherResponse awaits and returns a response body as a string.
 * Use await gatherResponse(..) in an async function to get the response body
 * @param {Response} response
 */
async function gatherResponse(response) {
  const { headers } = response
  const contentType = headers.get(&#39;content-type&#39;)
  if (contentType.includes(&#39;application/json&#39;)) {
    return await response.json()
  } else if (contentType.includes(&#39;application/text&#39;)) {
    return await response.text()
  } else if (contentType.includes(&#39;text/html&#39;)) {
    return await response.text()
  } else {
    return await response.text()
  }
}
/**
 * Example someHost at url is set up to respond with HTML
 * Replace url with the host you wish to send requests to
 *  */
const someHost = &#39;https://workers-tooling.cf/demos&#39;
const url = someHost &#43; &#39;/static/html&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  }\n  const response = await fetch(url, init)\n  const results = await gatherResponse(response)\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost at url is set up to respond with HTML\n * Replace url with the host you wish to send requests to\n *  */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url = someHost + '/static/html'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#14a82a672534b0dd25b385a5d3de744c:https://example.com"}},"description":"Sends a request to a remote server, reads HTML from the response, then serves that HTML.","id":"fetch_html","title":"Fetch HTML","type":"snippet","weight":20}
    </script>
    
    <figure class="template-card snippet" id="signed_request">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/signed_request>
    <h2>
      Signed Request/Response
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Check signatures of requests and sign responses with a private key</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>// NOTE Requires ESM through webpack project type
const crypto = require(&#39;crypto&#39;)
const SECRET = &#39;SECRET_KEY&#39;
async function handleRequest(request) {
  let signed = await checkSignature(request)
  if (signed) {
    let responseBody = &#39;Hello worker!&#39;
    return await signResponse(responseBody, new Response(responseBody))
  } else {
    return new Response(&#39;Request not signed&#39;, { status: 400 })
  }
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  console.log(createHexSignature(&#39;asd&#39;))
  event.respondWith(handleRequest(event.request))
})
async function createHexSignature(requestBody) {
  let hmac = crypto.createHmac(&#39;sha256&#39;, SECRET)
  hmac.update(requestBody)
  return hmac.digest(&#39;hex&#39;)
}
async function checkSignature(request) {
  // hash request with secret key
  let expectedSignature = await createHexSignature(await request.text())
  let actualSignature = await request.headers.get(&#39;signature&#39;)
  // check that hash matches signature
  return expectedSignature === actualSignature
}
async function signResponse(responseBody, response) {
  // create signature
  const signature = await createHexSignature(responseBody)
  response.headers.set(&#39;signature&#39;, signature)
  //add header with signature
  return response
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"// NOTE Requires ESM through webpack project type\nconst crypto = require('crypto')\nconst SECRET = 'SECRET_KEY'\nasync function handleRequest(request) {\n  let signed = await checkSignature(request)\n  if (signed) {\n    let responseBody = 'Hello worker!'\n    return await signResponse(responseBody, new Response(responseBody))\n  } else {\n    return new Response('Request not signed', { status: 400 })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  console.log(createHexSignature('asd'))\n  event.respondWith(handleRequest(event.request))\n})\nasync function createHexSignature(requestBody) {\n  let hmac = crypto.createHmac('sha256', SECRET)\n  hmac.update(requestBody)\n  return hmac.digest('hex')\n}\nasync function checkSignature(request) {\n  // hash request with secret key\n  let expectedSignature = await createHexSignature(await request.text())\n  let actualSignature = await request.headers.get('signature')\n  // check that hash matches signature\n  return expectedSignature === actualSignature\n}\nasync function signResponse(responseBody, response) {\n  // create signature\n  const signature = await createHexSignature(responseBody)\n  response.headers.set('signature', signature)\n  //add header with signature\n  return response\n}\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/?hide_editor#c22ea0102fb9dced927a9b870e9c546a:https://example.com/"}},"description":"Check signatures of requests and sign responses with a private key","id":"signed_request","share_url":"/templates/snippets/signed_request","title":"Signed Request/Response","type":"snippet","weight":10}
    </script>
    
    <figure class="template-card snippet" id="block_on_tls_version">
  <div class="tag-group">
    
    <button class="tooltip Middleware">
      Middleware
      <span class="tooltiptext"></span>
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/block_on_tls_version>
    <h2>
      Block on TLS Version
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Inspects the incoming request&rsquo;s TLS version and blocks if under TLSv1.2.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  try {
    let tlsVersion = request.cf.tlsVersion
    // Allow only TLS versions 1.2 and 1.3
    if (tlsVersion != &#39;TLSv1.2&#39; &amp;&amp; tlsVersion != &#39;TLSv1.3&#39;) {
      return new Response(&#39;Please use TLS version 1.2 or higher.&#39;, {
        status: 403,
      })
    }
    return fetch(request)
  } catch (err) {
    console.error(
      &#39;request.cf does not exist in the previewer, only in production&#39;,
    )
    return new Response(&#39;Error in workers script&#39; &#43; err.message, {
      status: 500,
    })
  }
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  try {\n    let tlsVersion = request.cf.tlsVersion\n    // Allow only TLS versions 1.2 and 1.3\n    if (tlsVersion != 'TLSv1.2' \u0026\u0026 tlsVersion != 'TLSv1.3') {\n      return new Response('Please use TLS version 1.2 or higher.', {\n        status: 403,\n      })\n    }\n    return fetch(request)\n  } catch (err) {\n    console.error(\n      'request.cf does not exist in the previewer, only in production',\n    )\n    return new Response('Error in workers script' + err.message, {\n      status: 500,\n    })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","description":"Inspects the incoming request's TLS version and blocks if under TLSv1.2.","id":"block_on_tls_version","tags":["Middleware"],"title":"Block on TLS Version","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="post_data">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/post_data>
    <h2>
      Read POST Data
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Serves an HTML form, then reads POSTs from that form data. Can also be used to read JSON or other POST data from an incoming request.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handlePostRequest(request) {
  let reqBody = await readRequestBody(request)
  let retBody = `The request body sent in was ${reqBody}`
  return new Response(retBody)
}
async function handleRequest(request) {
  let retBody = `The request was a GET `
  return new Response(retBody)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  const { request } = event
  const { url } = request
  if (url.includes(&#39;form&#39;)) {
    return event.respondWith(rawHtmlResponse(someForm))
  }
  if (request.method === &#39;POST&#39;) {
    return event.respondWith(handlePostRequest(request))
  } else if (request.method === &#39;GET&#39;) {
    return event.respondWith(handleRequest(request))
  }
})
/**
 * rawHtmlResponse delievers a response with HTML inputted directly
 * into the worker script
 * @param {string} html
 */
async function rawHtmlResponse(html) {
  const init = {
    headers: {
      &#39;content-type&#39;: &#39;text/html;charset=UTF-8&#39;,
    },
  }
  return new Response(html, init)
}
/**
 * readRequestBody reads in the incoming request body
 * Use await readRequestBody(..) in an async function to get the string
 * @param {Request} request the incoming request to read from
 */
async function readRequestBody(request) {
  const { headers } = request
  const contentType = headers.get(&#39;content-type&#39;)
  if (contentType.includes(&#39;application/json&#39;)) {
    const body = await request.json()
    return JSON.stringify(body)
  } else if (contentType.includes(&#39;application/text&#39;)) {
    const body = await request.text()
    return body
  } else if (contentType.includes(&#39;text/html&#39;)) {
    const body = await request.text()
    return body
  } else if (contentType.includes(&#39;form&#39;)) {
    const formData = await request.formData()
    let body = {}
    for (let entry of formData.entries()) {
      body[entry[0]] = entry[1]
    }
    return JSON.stringify(body)
  } else {
    let myBlob = await request.blob()
    var objectURL = URL.createObjectURL(myBlob)
    return objectURL
  }
}
const someForm = `
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Hello World&lt;/h1&gt;
&lt;p&gt;This is all generated using a Worker&lt;/p&gt;
&lt;form action=&#34;/demos/requests&#34; method=&#34;post&#34;&gt;
  &lt;div&gt;
    &lt;label for=&#34;say&#34;&gt;What  do you want to say?&lt;/label&gt;
    &lt;input name=&#34;say&#34; id=&#34;say&#34; value=&#34;Hi&#34;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;label for=&#34;to&#34;&gt;To who?&lt;/label&gt;
    &lt;input name=&#34;to&#34; id=&#34;to&#34; value=&#34;Mom&#34;&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;button&gt;Send my greetings&lt;/button&gt;
  &lt;/div&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handlePostRequest(request) {\n  let reqBody = await readRequestBody(request)\n  let retBody = `The request body sent in was ${reqBody}`\n  return new Response(retBody)\n}\nasync function handleRequest(request) {\n  let retBody = `The request was a GET `\n  return new Response(retBody)\n}\naddEventListener('fetch', event =\u003e {\n  const { request } = event\n  const { url } = request\n  if (url.includes('form')) {\n    return event.respondWith(rawHtmlResponse(someForm))\n  }\n  if (request.method === 'POST') {\n    return event.respondWith(handlePostRequest(request))\n  } else if (request.method === 'GET') {\n    return event.respondWith(handleRequest(request))\n  }\n})\n/**\n * rawHtmlResponse delievers a response with HTML inputted directly\n * into the worker script\n * @param {string} html\n */\nasync function rawHtmlResponse(html) {\n  const init = {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  }\n  return new Response(html, init)\n}\n/**\n * readRequestBody reads in the incoming request body\n * Use await readRequestBody(..) in an async function to get the string\n * @param {Request} request the incoming request to read from\n */\nasync function readRequestBody(request) {\n  const { headers } = request\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    const body = await request.json()\n    return JSON.stringify(body)\n  } else if (contentType.includes('application/text')) {\n    const body = await request.text()\n    return body\n  } else if (contentType.includes('text/html')) {\n    const body = await request.text()\n    return body\n  } else if (contentType.includes('form')) {\n    const formData = await request.formData()\n    let body = {}\n    for (let entry of formData.entries()) {\n      body[entry[0]] = entry[1]\n    }\n    return JSON.stringify(body)\n  } else {\n    let myBlob = await request.blob()\n    var objectURL = URL.createObjectURL(myBlob)\n    return objectURL\n  }\n}\nconst someForm = `\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003cbody\u003e\n\u003ch1\u003eHello World\u003c/h1\u003e\n\u003cp\u003eThis is all generated using a Worker\u003c/p\u003e\n\u003cform action=\"/demos/requests\" method=\"post\"\u003e\n  \u003cdiv\u003e\n    \u003clabel for=\"say\"\u003eWhat  do you want to say?\u003c/label\u003e\n    \u003cinput name=\"say\" id=\"say\" value=\"Hi\"\u003e\n  \u003c/div\u003e\n  \u003cdiv\u003e\n    \u003clabel for=\"to\"\u003eTo who?\u003c/label\u003e\n    \u003cinput name=\"to\" id=\"to\" value=\"Mom\"\u003e\n  \u003c/div\u003e\n  \u003cdiv\u003e\n    \u003cbutton\u003eSend my greetings\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/form\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n","demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#a6a285e4e2bfbebea0be31b9eeaca3e6:https://example.com/form"}},"description":"Serves an HTML form, then reads POSTs from that form data. Can also be used to read JSON or other POST data from an incoming request.","id":"post_data","title":"Read POST Data","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="modify_res_props">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/modify_res_props>
    <h2>
      Modify Response
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Recommended practice for mutating a fetched <a href="https://developers.cloudflare.com/workers/reference/apis/response">response</a>. First, fetches a request then modifies specific properties which are immutable: <code>status</code>, <code>statusText</code>, <code>headers</code> and <code>body</code>.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  /**
   * Best practice is to only assign properties on the response
   * object (i.e. ResponseInit props) through either a method or the constructor
   * since properties are immutable
   */
  let originalResponse = await fetch(request)
  let originalBody = await originalResponse.json()
  // Change status and statusText
  // Make sure to pass in originalResponse to preserving all parts
  // of the original response except the part we want to update.
  let response = new Response(originalResponse, { status: 500, statusText: &#39;some message&#39; })
  // Change response body by adding the foo prop
  let body = JSON.stringify({ foo: &#39;bar&#39;, ...originalBody })
  response = new Response(body, response)
  // Add a header using set method
  response.headers.set(&#39;foo&#39;, &#39;bar&#39;)
  // Set destination header to the value of the source header
  if (response.headers.has(headerNameSrc)) {
    response.headers.set(headerNameDst, response.headers.get(headerNameSrc))
    console.log(
      `Response header &#34;${headerNameDst}&#34; was set to &#34;${response.headers.get(headerNameDst)}&#34;`,
    )
  }
  return response
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * @param {string} headerNameSrc the header to get the new value from
 * @param {string} headerNameDst the header to set based off of value in src
 */
const headerNameSrc = &#39;foo&#39;//&#39;Orig-Header&#39;
const headerNameDst = &#39;Last-Modified&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  /**\n   * Best practice is to only assign properties on the response\n   * object (i.e. ResponseInit props) through either a method or the constructor\n   * since properties are immutable\n   */\n  let originalResponse = await fetch(request)\n  let originalBody = await originalResponse.json()\n  // Change status and statusText\n  // Make sure to pass in originalResponse to preserving all parts\n  // of the original response except the part we want to update.\n  let response = new Response(originalResponse, { status: 500, statusText: 'some message' })\n  // Change response body by adding the foo prop\n  let body = JSON.stringify({ foo: 'bar', ...originalBody })\n  response = new Response(body, response)\n  // Add a header using set method\n  response.headers.set('foo', 'bar')\n  // Set destination header to the value of the source header\n  if (response.headers.has(headerNameSrc)) {\n    response.headers.set(headerNameDst, response.headers.get(headerNameSrc))\n    console.log(\n      `Response header \"${headerNameDst}\" was set to \"${response.headers.get(headerNameDst)}\"`,\n    )\n  }\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * @param {string} headerNameSrc the header to get the new value from\n * @param {string} headerNameDst the header to set based off of value in src\n */\nconst headerNameSrc = 'foo'//'Orig-Header'\nconst headerNameDst = 'Last-Modified'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#daf0e96ae0ff4ce3f103c14bf6d968df:http://workers-tooling.cf/demos/static/json"}},"description":"Recommended practice for mutating a fetched [response](/reference/apis/response). First, fetches a request then modifies specific properties which are immutable: `status`, `statusText`, `headers` and `body`.","id":"modify_res_props","title":"Modify Response","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="private_data_loss">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/private_data_loss>
    <h2>
      Data Loss Prevention
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Prevent access to personal and sensitive data by inspecting response data from an origin server. In this example, sensitive data is defined by regexes for email, UK mobile number, or credit card number. If a match is detected, trigger a data breach alert and respond with either a block or the data stripped from the response.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>const SOME_HOOK_SERVER = &#39;https://webhook.flow-wolf.io/hook&#39;
const DEBUG = true
/**
 * Define personal data with regular expressions
 * Respond with block if credit card data, and strip
 * emails and phone numbers from the response
 * Execution will be limited to MIME type &#34;text/*&#34;
 */
async function handleRequest(request) {
  let response = await fetch(request)
  // Return origin responst, if response wasn&#39;t text
  let contentType = response.headers.get(&#39;content-type&#39;)
  if (!contentType.toLowerCase().includes(&#39;text/&#39;)) {
    return response
  }
  let text = await response.text()
  text = DEBUG
    ? // for testing only - replace the response from the origin with an email
      text.replace(&#39;You may use this&#39;, &#39;me@example.com may use this&#39;)
    : text
  const sensitiveRegexsMap = {
    email: String.raw`\b[A-Z0-9._%&#43;-]&#43;@[A-Z0-9.-]&#43;\.[A-Z]{2,}\b`,
    phone: String.raw`\b07\d{9}\b`,
    creditCard: String.raw`\b(?:4[0-9]{12}(?:[0-9]{3})?|(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\d{3})\d{11})\b`,
  }
  for (const kind in sensitiveRegexsMap) {
    let sensitiveRegex = new RegExp(sensitiveRegexsMap[kind], &#39;ig&#39;)
    let match = await sensitiveRegex.test(text)
    if (match) {
      // alert a data breach by posting to a webhook server
      await postDataBreach(request)
      // respond with a block if credit card, else replace
      // senstive text with *&#39;s
      return kind === &#39;creditCard&#39;
        ? new Response(kind &#43; &#39; found\nForbidden\n&#39;, {
            status: 403,
            statusText: &#39;Forbidden&#39;,
          })
        : new Response(text.replace(sensitiveRegex, &#39;**********&#39;), response)
    }
  }
  return new Response(text, response)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
async function postDataBreach(request) {
  let trueClientIp = request.headers.get(&#39;cf-connecting-ip&#39;)
  let epoch = new Date().getTime()
  const body = {
    ip: trueClientIp,
    time: epoch,
    request: request,
  }
  const init = {
    body: JSON.stringify(body),
    method: &#39;POST&#39;,
    headers: {
      &#39;content-type&#39;: &#39;application/json;charset=UTF-8&#39;,
    },
  }
  return await fetch(SOME_HOOK_SERVER, init)
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"const SOME_HOOK_SERVER = 'https://webhook.flow-wolf.io/hook'\nconst DEBUG = true\n/**\n * Define personal data with regular expressions\n * Respond with block if credit card data, and strip\n * emails and phone numbers from the response\n * Execution will be limited to MIME type \"text/*\"\n */\nasync function handleRequest(request) {\n  let response = await fetch(request)\n  // Return origin responst, if response wasn't text\n  let contentType = response.headers.get('content-type')\n  if (!contentType.toLowerCase().includes('text/')) {\n    return response\n  }\n  let text = await response.text()\n  text = DEBUG\n    ? // for testing only - replace the response from the origin with an email\n      text.replace('You may use this', 'me@example.com may use this')\n    : text\n  const sensitiveRegexsMap = {\n    email: String.raw`\\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}\\b`,\n    phone: String.raw`\\b07\\d{9}\\b`,\n    creditCard: String.raw`\\b(?:4[0-9]{12}(?:[0-9]{3})?|(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\\d{3})\\d{11})\\b`,\n  }\n  for (const kind in sensitiveRegexsMap) {\n    let sensitiveRegex = new RegExp(sensitiveRegexsMap[kind], 'ig')\n    let match = await sensitiveRegex.test(text)\n    if (match) {\n      // alert a data breach by posting to a webhook server\n      await postDataBreach(request)\n      // respond with a block if credit card, else replace\n      // senstive text with *'s\n      return kind === 'creditCard'\n        ? new Response(kind + ' found\\nForbidden\\n', {\n            status: 403,\n            statusText: 'Forbidden',\n          })\n        : new Response(text.replace(sensitiveRegex, '**********'), response)\n    }\n  }\n  return new Response(text, response)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\nasync function postDataBreach(request) {\n  let trueClientIp = request.headers.get('cf-connecting-ip')\n  let epoch = new Date().getTime()\n  const body = {\n    ip: trueClientIp,\n    time: epoch,\n    request: request,\n  }\n  const init = {\n    body: JSON.stringify(body),\n    method: 'POST',\n    headers: {\n      'content-type': 'application/json;charset=UTF-8',\n    },\n  }\n  return await fetch(SOME_HOOK_SERVER, init)\n}\n","demos":{"main":{"share_url":"/templates/snippets/private_data_loss","tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#1b7ac657cfaec2635a319441800a5158:https://example.com/"}},"description":"Prevent access to personal and sensitive data by inspecting response data from an origin server. In this example, sensitive data is defined by regexes for email, UK mobile number, or credit card number. If a match is detected, trigger a data breach alert and respond with either a block or the data stripped from the response.","id":"private_data_loss","title":"Data Loss Prevention","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="hot_link_protection">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/hot_link_protection>
    <h2>
      Hot-link Protection
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Block other websites from linking to your content</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>const HOMEPAGE_URL = &#39;https://tutorial.cloudflareworkers.com/&#39;
const PROTECTED_TYPE = &#39;images/&#39;
async function handleRequest(request) {
  // Fetch the original request
  let response = await fetch(request)
  // If it&#39;s an image, engage hotlink protection based on the
  // Referer header.
  let referer = request.headers.get(&#39;Referer&#39;)
  let contentType = response.headers.get(&#39;Content-Type&#39;) || &#39;&#39;
  if (referer &amp;&amp; contentType.startsWith(PROTECTED_TYPE)) {
    // If the hostnames don&#39;t match, it&#39;s a hotlink
    if (new URL(referer).hostname !== new URL(request.url).hostname) {
      // Redirect the user to your website
      return Response.redirect(url, 302)
    }
  }
  // Everything is fine, return the response normally.
  return response
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"const HOMEPAGE_URL = 'https://tutorial.cloudflareworkers.com/'\nconst PROTECTED_TYPE = 'images/'\nasync function handleRequest(request) {\n  // Fetch the original request\n  let response = await fetch(request)\n  // If it's an image, engage hotlink protection based on the\n  // Referer header.\n  let referer = request.headers.get('Referer')\n  let contentType = response.headers.get('Content-Type') || ''\n  if (referer \u0026\u0026 contentType.startsWith(PROTECTED_TYPE)) {\n    // If the hostnames don't match, it's a hotlink\n    if (new URL(referer).hostname !== new URL(request.url).hostname) {\n      // Redirect the user to your website\n      return Response.redirect(url, 302)\n    }\n  }\n  // Everything is fine, return the response normally.\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"share_url":"/templates/snippets/hotlink-protection","text":"Demo","url":"https://cloudflareworkers.com/#d659b20dcf91df6e6de1bedbb94f6702:https://www.cloudflare.com/img/logo-cloudflare-dark.svg"}},"description":"Block other websites from linking to your content","id":"hot_link_protection","title":"Hot-link Protection","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="modify_req_props">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/modify_req_props>
    <h2>
      Modify Request Property
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Recommended practice for forming a <a href="https://developers.cloudflare.com/workers/reference/apis/request">request</a> based off the incoming request. First, takes in the incoming request then modifies specific properties like POST <code>body</code>, <code>redirect</code>, and the Cloudflare specific property <code>cf</code> and runs the fetch.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  /**
   * Best practice is to only assign new properties on the request
   * object (i.e. RequestInit props) through either a method or the constructor
   */
  let newRequestInit = {
    // Change method
    method: &#39;POST&#39;,
    // Change body
    body: JSON.stringify({ bar: &#39;foo&#39; }),
    // Change the redirect mode.
    redirect: &#39;follow&#39;,
    //Change headers, note this method will erase existing headers
    headers: {
      &#39;Content-Type&#39;: &#39;application/json&#39;,
    },
    // Change a Cloudflare feature on the outbound response
    cf: { apps: false },
  }
  // Change URL
  let url = someUrl
  // Change just the host
  url = new URL(url)
  url.hostname = someHost
  // Best practice is to always use the original request to construct the new request
  // thereby cloning all the attributes, applying the URL also requires a constructor
  // since once a Request has been constructed, its URL is immutable.
  const newRequest = new Request(url, new Request(request, newRequestInit))
  // Set headers using method
  newRequest.headers.set(&#39;X-Example&#39;, &#39;bar&#39;)
  newRequest.headers.set(&#39;Content-Type&#39;, &#39;application/json&#39;)
  try {
    return await fetch(newRequest)
  } catch (e) {
    return new Response(JSON.stringify({ error: e.message }), { status: 500 })
  }
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * Example someHost is set up to return raw JSON
 * @param {string} someUrl the URL to send the request to, since we are setting hostname too only path is applied
 * @param {string} someHost the host the request will resolve too
 */
const someHost = &#39;example.com&#39;
const someUrl = &#39;https://foo.example.com/api.js&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  /**\n   * Best practice is to only assign new properties on the request\n   * object (i.e. RequestInit props) through either a method or the constructor\n   */\n  let newRequestInit = {\n    // Change method\n    method: 'POST',\n    // Change body\n    body: JSON.stringify({ bar: 'foo' }),\n    // Change the redirect mode.\n    redirect: 'follow',\n    //Change headers, note this method will erase existing headers\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    // Change a Cloudflare feature on the outbound response\n    cf: { apps: false },\n  }\n  // Change URL\n  let url = someUrl\n  // Change just the host\n  url = new URL(url)\n  url.hostname = someHost\n  // Best practice is to always use the original request to construct the new request\n  // thereby cloning all the attributes, applying the URL also requires a constructor\n  // since once a Request has been constructed, its URL is immutable.\n  const newRequest = new Request(url, new Request(request, newRequestInit))\n  // Set headers using method\n  newRequest.headers.set('X-Example', 'bar')\n  newRequest.headers.set('Content-Type', 'application/json')\n  try {\n    return await fetch(newRequest)\n  } catch (e) {\n    return new Response(JSON.stringify({ error: e.message }), { status: 500 })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Example someHost is set up to return raw JSON\n * @param {string} someUrl the URL to send the request to, since we are setting hostname too only path is applied\n * @param {string} someHost the host the request will resolve too\n */\nconst someHost = 'example.com'\nconst someUrl = 'https://foo.example.com/api.js'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#27b91145f66b6cfce1b3190ed7ba0bc5:https://example.com"}},"description":"Recommended practice for forming a [request](/reference/apis/request) based off the incoming request. First, takes in the incoming request then modifies specific properties like POST `body`, `redirect`, and the Cloudflare specific property `cf` and runs the fetch.","id":"modify_req_props","share_url":"/templates/snippets/modify_req_props","title":"Modify Request Property","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="http2_server_push">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/http2_server_push>
    <h2>
      HTTP/2 Server Push
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Push static assests to a client&rsquo;s browser without waiting for HTML to render</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  // If request is for test.css just serve the raw CSS
  if (/test.css$/.test(request.url)) {
    return new Response(CSS, {
      headers: {
        &#39;content-type&#39;: &#39;text/css&#39;,
      },
    })
  } else {
    // serve raw HTML using HTTP/2 for the CSS file
    return new Response(HTML, {
      headers: {
        &#39;content-type&#39;: &#39;text/html&#39;,
        Link: &#39;&lt;/http2_push/h2p/test.css&gt;; rel=preload;&#39;,
      },
    })
  }
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
const CSS = `body { color: red; }`
const HTML = `
&lt;!doctype html&gt;
&lt;html lang=&#34;en&#34;&gt;
  &lt;head&gt;
    &lt;meta charset=&#34;utf-8&#34;&gt;
    &lt;title&gt;Server push test&lt;/title&gt;
    &lt;link rel=&#34;stylesheet&#34; href=&#34;http2_push/h2p/test.css&#34;&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Server push test page&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
`
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  // If request is for test.css just serve the raw CSS\n  if (/test.css$/.test(request.url)) {\n    return new Response(CSS, {\n      headers: {\n        'content-type': 'text/css',\n      },\n    })\n  } else {\n    // serve raw HTML using HTTP/2 for the CSS file\n    return new Response(HTML, {\n      headers: {\n        'content-type': 'text/html',\n        Link: '\u003c/http2_push/h2p/test.css\u003e; rel=preload;',\n      },\n    })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\nconst CSS = `body { color: red; }`\nconst HTML = `\n\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"utf-8\"\u003e\n    \u003ctitle\u003eServer push test\u003c/title\u003e\n    \u003clink rel=\"stylesheet\" href=\"http2_push/h2p/test.css\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003ch1\u003eServer push test page\u003c/h1\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n`\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#f7b7e99bec493ba4f4847a095c4fa61c:https://tutorial.cloudflareworkers.com/"}},"description":"Push static assests to a client's browser without waiting for HTML to render","id":"http2_server_push","title":"HTTP/2 Server Push","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="bulk_origin_proxies">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/bulk_origin_proxies>
    <h2>
      Bulk Origin Proxies
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Resolve requests to your domain to a set of proxy third-party origins</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  let url = new URL(request.url)
  // Check if incoming hostname is
  // a key in the ORIGINS object
  let target = ORIGINS[url.hostname]
  // If it is, proxy request to that third party origin
  if (target) {
    url.hostname = target
    return fetch(url, request)
  }
  // Otherwise, process request as normal
  return fetch(request)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * An object with different url&#39;s to fetch
 * @param {Object} ORIGINS
 */
const ORIGINS = {
  &#39;starwarsapi.yourdomain.com&#39;: &#39;swapi.co&#39;,
  &#39;google.yourdomain.com&#39;: &#39;google.com&#39;,
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  let url = new URL(request.url)\n  // Check if incoming hostname is\n  // a key in the ORIGINS object\n  let target = ORIGINS[url.hostname]\n  // If it is, proxy request to that third party origin\n  if (target) {\n    url.hostname = target\n    return fetch(url, request)\n  }\n  // Otherwise, process request as normal\n  return fetch(request)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * An object with different url's to fetch\n * @param {Object} ORIGINS\n */\nconst ORIGINS = {\n  'starwarsapi.yourdomain.com': 'swapi.co',\n  'google.yourdomain.com': 'google.com',\n}\n","demos":{"main":{"share_url":"/templates/snippets/bulk_origin_proxies","text":"Demo","url":"https://cloudflareworkers.com/#545c79e098708ca658dcbdb860c5021a:https://starwarsapi.yourdomain.com/"}},"description":"Resolve requests to your domain to a set of proxy third-party origins","id":"bulk_origin_proxies","title":"Bulk Origin Proxies","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="ab_testing">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/ab_testing>
    <h2>
      A/B Testing
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Set up an A/B test by controlling what response is served based on cookies</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const NAME = &#39;experiment-0&#39;
  // Responses below are place holders, you could set up
  // a custom path for each test (e.g. /control/somepath )
  const TEST_RESPONSE = new Response(&#39;Test group&#39;) // fetch(&#39;/test/sompath&#39;, request)
  const CONTROL_RESPONSE = new Response(&#39;Control group&#39;) // fetch(&#39;/control/sompath&#39;, request)
  // Determine which group this requester is in.
  const cookie = request.headers.get(&#39;cookie&#39;)
  if (cookie &amp;&amp; cookie.includes(`${NAME}=control`)) {
    return CONTROL_RESPONSE
  } else if (cookie &amp;&amp; cookie.includes(`${NAME}=test`)) {
    return TEST_RESPONSE
  } else {
    // if no cookie then this is a new client, decide a group and set the cookie
    let group = Math.random() &lt; 0.5 ? &#39;test&#39; : &#39;control&#39; // 50/50 split
    let response = group === &#39;control&#39; ? CONTROL_RESPONSE : TEST_RESPONSE
    response.headers.append(&#39;Set-Cookie&#39;, `${NAME}=${group}; path=/`)
    return response
  }
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const NAME = 'experiment-0'\n  // Responses below are place holders, you could set up\n  // a custom path for each test (e.g. /control/somepath )\n  const TEST_RESPONSE = new Response('Test group') // fetch('/test/sompath', request)\n  const CONTROL_RESPONSE = new Response('Control group') // fetch('/control/sompath', request)\n  // Determine which group this requester is in.\n  const cookie = request.headers.get('cookie')\n  if (cookie \u0026\u0026 cookie.includes(`${NAME}=control`)) {\n    return CONTROL_RESPONSE\n  } else if (cookie \u0026\u0026 cookie.includes(`${NAME}=test`)) {\n    return TEST_RESPONSE\n  } else {\n    // if no cookie then this is a new client, decide a group and set the cookie\n    let group = Math.random() \u003c 0.5 ? 'test' : 'control' // 50/50 split\n    let response = group === 'control' ? CONTROL_RESPONSE : TEST_RESPONSE\n    response.headers.append('Set-Cookie', `${NAME}=${group}; path=/`)\n    return response\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#12a2962014e1324e3a416a5a76e1f81f:https://tutorial.cloudflareworkers.com"}},"description":"Set up an A/B test by controlling what response is served based on cookies","id":"ab_testing","share_url":"/templates/snippets/ab_testing","title":"A/B Testing","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="bulk_redirects">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/bulk_redirects>
    <h2>
      Bulk Redirects
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Redirects requests to certain URLs based a mapped object to the request&rsquo;s URL.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  let requestURL = new URL(request.url)
  let path = requestURL.pathname.split(&#39;/redirect&#39;)[1]
  let location = redirectMap.get(path)
  if (location) {
    return Response.redirect(location, 301)
  }
  // If in map, return the original request
  return fetch(request)
}
addEventListener(&#39;fetch&#39;, async event =&gt; {
  event.respondWith(handleRequest(event.request))
})
const externalHostname = &#39;workers-tooling.cf&#39;
const redirectMap = new Map([
  [&#39;/bulk1&#39;, &#39;https://&#39; &#43; externalHostname &#43; &#39;/redirect2&#39;],
  [&#39;/bulk2&#39;, &#39;https://&#39; &#43; externalHostname &#43; &#39;/redirect3&#39;],
  [&#39;/bulk3&#39;, &#39;https://&#39; &#43; externalHostname &#43; &#39;/redirect4&#39;],
  [&#39;/bulk4&#39;, &#39;https://google.com&#39;],
])
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  let requestURL = new URL(request.url)\n  let path = requestURL.pathname.split('/redirect')[1]\n  let location = redirectMap.get(path)\n  if (location) {\n    return Response.redirect(location, 301)\n  }\n  // If in map, return the original request\n  return fetch(request)\n}\naddEventListener('fetch', async event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\nconst externalHostname = 'workers-tooling.cf'\nconst redirectMap = new Map([\n  ['/bulk1', 'https://' + externalHostname + '/redirect2'],\n  ['/bulk2', 'https://' + externalHostname + '/redirect3'],\n  ['/bulk3', 'https://' + externalHostname + '/redirect4'],\n  ['/bulk4', 'https://google.com'],\n])\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#d17c3da192fd5c83ef7d28153ab32f3f:https://example.com/redirect/bulk1"}},"description":"Redirects requests to certain URLs based a mapped object to the request's URL.","id":"bulk_redirects","title":"Bulk Redirects","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="cache_ttl">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/cache_ttl>
    <h2>
      Cache TTL and Custom Keys
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Determine how/if Cloudflare&rsquo;s <a href="https://developers.cloudflare.com/workers/about/using-cache.md#cloudflare-s-cdn">Classic CDN</a> and Browsers will cache a resource by setting TTLs, cache keys, and cache settings.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  let url = new URL(request.url)
  // Only use the path for the cache key, removing query strings
  // and always storing HTTPS e.g. https://www.example.com/file-uri-here
  let someCustomKey = `https://${url.hostname}${url.pathname}`
  let response = await fetch(request, {
    cf: {
      // Tell Cloudflare&#39;s Global CDN to always cache this fetch regardless of content type
      // for a max of 5 seconds before revalidating the resource
      cacheTtl: 5, // sets TTL to 5 and cacheEverything setting
      //Enterprise only feature, see Cache API for other plans
      cacheKey: someCustomKey,
    },
  })
  // must use Response constructor to inherit all of response&#39;s fields
  response = new Response(response.body, response)
  //Set cache control headers to cache on browser for 25 minutes
  response.headers.set(&#39;Cache-Control&#39;, &#39;max-age=1500&#39;)
  return response
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  let url = new URL(request.url)\n  // Only use the path for the cache key, removing query strings\n  // and always storing HTTPS e.g. https://www.example.com/file-uri-here\n  let someCustomKey = `https://${url.hostname}${url.pathname}`\n  let response = await fetch(request, {\n    cf: {\n      // Tell Cloudflare's Global CDN to always cache this fetch regardless of content type\n      // for a max of 5 seconds before revalidating the resource\n      cacheTtl: 5, // sets TTL to 5 and cacheEverything setting\n      //Enterprise only feature, see Cache API for other plans\n      cacheKey: someCustomKey,\n    },\n  })\n  // must use Response constructor to inherit all of response's fields\n  response = new Response(response.body, response)\n  //Set cache control headers to cache on browser for 25 minutes\n  response.headers.set('Cache-Control', 'max-age=1500')\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"tags":["Middleware","Enterprise"],"text":"Demo","url":"https://cloudflareworkers.com/#8dd3e29985701b05e43b4dd74c387b74:https://example.com/"}},"description":"Determine how/if Cloudflare's [Classic CDN](/about/using-cache.md#cloudflare-s-cdn) and Browsers will cache a resource by setting TTLs, cache keys, and cache settings.","id":"cache_ttl","title":"Cache TTL and Custom Keys","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="send_raw_html">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/send_raw_html>
    <h2>
      Send Raw HTML
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Delivers an HTML page from HTML directly in the Worker script.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const init = {
    headers: {
      &#39;content-type&#39;: &#39;text/html;charset=UTF-8&#39;,
    },
  }
  return new Response(someHTML, init)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
const someHTML =  `&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;body&gt;
  &lt;h1&gt;Hello World&lt;/h1&gt;
  &lt;p&gt;This is all generated using a Worker&lt;/p&gt;
  &lt;iframe
      width=&#34;560&#34;
      height=&#34;315&#34;
      src=&#34;https://www.youtube.com/embed/dQw4w9WgXcQ&#34;
      frameborder=&#34;0&#34;
      allow=&#34;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&#34;
      allowfullscreen
  &gt;&lt;/iframe&gt;
  &lt;/body&gt;
&lt;/html&gt;
`
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  }\n  return new Response(someHTML, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\nconst someHTML =  `\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003cbody\u003e\n  \u003ch1\u003eHello World\u003c/h1\u003e\n  \u003cp\u003eThis is all generated using a Worker\u003c/p\u003e\n  \u003ciframe\n      width=\"560\"\n      height=\"315\"\n      src=\"https://www.youtube.com/embed/dQw4w9WgXcQ\"\n      frameborder=\"0\"\n      allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n      allowfullscreen\n  \u003e\u003c/iframe\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n`\n","demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#ba06ef26637ab98b1f38a18dc527dc69:https://example.com"}},"description":"Delivers an HTML page from HTML directly in the Worker script.","id":"send_raw_html","share_url":"/templates/snippets/send_raw_html","title":"Send Raw HTML","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="rewrite_links_html">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/rewrite_links_html>
    <h2>
      Rewrite links in HTML
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Rewrite URL links in HTML using <a href="https://developers.cloudflare.com/workers/reference/apis/html-rewriter">HTML Rewriter</a></p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>const OLD_URL = &#39;developer.mozilla.org&#39;
const NEW_URL = &#39;mynewdomain.com&#39;

async function handleRequest(req) {
  const res = await fetch(req)
  return rewriter.transform(res)
}

class AttributeRewriter {
  constructor(attributeName) {
    this.attributeName = attributeName
  }

  element(element) {
    const attribute = element.getAttribute(this.attributeName)
    if (attribute) {
      element.setAttribute(
        this.attributeName,
        attribute.replace(OLD_URL, NEW_URL),
      )
    }
  }
}

const rewriter = new HTMLRewriter()
  .on(&#39;a&#39;, new AttributeRewriter(&#39;href&#39;))
  .on(&#39;img&#39;, new AttributeRewriter(&#39;src&#39;))

addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"const OLD_URL = 'developer.mozilla.org'\nconst NEW_URL = 'mynewdomain.com'\n\nasync function handleRequest(req) {\n  const res = await fetch(req)\n  return rewriter.transform(res)\n}\n\nclass AttributeRewriter {\n  constructor(attributeName) {\n    this.attributeName = attributeName\n  }\n\n  element(element) {\n    const attribute = element.getAttribute(this.attributeName)\n    if (attribute) {\n      element.setAttribute(\n        this.attributeName,\n        attribute.replace(OLD_URL, NEW_URL),\n      )\n    }\n  }\n}\n\nconst rewriter = new HTMLRewriter()\n  .on('a', new AttributeRewriter('href'))\n  .on('img', new AttributeRewriter('src'))\n\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","description":"Rewrite URL links in HTML using [HTML Rewriter](/reference/apis/html-rewriter)","id":"rewrite_links_html","title":"Rewrite links in HTML","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="post_json">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/post_json>
    <h2>
      Post JSON
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Sends a POST request with JSON data from the Workers script.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const init = {
    body: JSON.stringify(body),
    method: &#39;POST&#39;,
    headers: {
      &#39;content-type&#39;: &#39;application/json;charset=UTF-8&#39;,
    },
  }
  const response = await fetch(url, init)
  const results = await gatherResponse(response)
  return new Response(results, init)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  return event.respondWith(handleRequest(event.request))
})
/**
 * gatherResponse awaits and returns a response body as a string.
 * Use await gatherResponse(..) in an async function to get the response body
 * @param {Response} response
 */
async function gatherResponse(response) {
  const { headers } = response
  const contentType = headers.get(&#39;content-type&#39;)
  if (contentType.includes(&#39;application/json&#39;)) {
    return await response.json()
  } else if (contentType.includes(&#39;application/text&#39;)) {
    return await response.text()
  } else if (contentType.includes(&#39;text/html&#39;)) {
    return await response.text()
  } else {
    return await response.text()
  }
}
/**
 * Example someHost is set up to take in a JSON request
 * Replace url with the host you wish to send requests to
 * @param {string} url the URL to send the request to
 * @param {BodyInit} body the JSON data to send in the request
 */
const someHost = &#39;https://workers-tooling.cf/demos&#39;
const url = someHost &#43; &#39;/requests/json&#39;
const body = {
  results: [&#39;default data to send&#39;],
  errors: null,
  msg: &#39;I sent this to the fetch&#39;,
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const init = {\n    body: JSON.stringify(body),\n    method: 'POST',\n    headers: {\n      'content-type': 'application/json;charset=UTF-8',\n    },\n  }\n  const response = await fetch(url, init)\n  const results = await gatherResponse(response)\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost is set up to take in a JSON request\n * Replace url with the host you wish to send requests to\n * @param {string} url the URL to send the request to\n * @param {BodyInit} body the JSON data to send in the request\n */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url = someHost + '/requests/json'\nconst body = {\n  results: ['default data to send'],\n  errors: null,\n  msg: 'I sent this to the fetch',\n}\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#edce60b7d57c1e98fbe2d931aaaaf25f:https://tutorial.cloudflareworkers.com"}},"description":"Sends a POST request with JSON data from the Workers script.","id":"post_json","title":"Post JSON","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="cookie_extract">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/cookie_extract>
    <h2>
      Extract Cookie Value
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Extracts the value of a cookie, given the cookie name.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>const COOKIE_NAME = &#39;__uid&#39;
async function handleRequest(request) {
  const cookie = getCookie(request, COOKIE_NAME)
  if (cookie) {
    // respond with the cookie value
    return new Response(cookie)
  }
  return new Response(&#39;No cookie with name: &#39; &#43; COOKIE_NAME)
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * Grabs the cookie with name from the request headers
 * @param {Request} request incoming Request
 * @param {string} name of the cookie to grab
 */
function getCookie(request, name) {
  let result = null
  let cookieString = request.headers.get(&#39;Cookie&#39;)
  if (cookieString) {
    let cookies = cookieString.split(&#39;;&#39;)
    cookies.forEach(cookie =&gt; {
      let cookieName = cookie.split(&#39;=&#39;)[0].trim()
      if (cookieName === name) {
        let cookieVal = cookie.split(&#39;=&#39;)[1]
        result = cookieVal
      }
    })
  }
  return result
}
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"const COOKIE_NAME = '__uid'\nasync function handleRequest(request) {\n  const cookie = getCookie(request, COOKIE_NAME)\n  if (cookie) {\n    // respond with the cookie value\n    return new Response(cookie)\n  }\n  return new Response('No cookie with name: ' + COOKIE_NAME)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Grabs the cookie with name from the request headers\n * @param {Request} request incoming Request\n * @param {string} name of the cookie to grab\n */\nfunction getCookie(request, name) {\n  let result = null\n  let cookieString = request.headers.get('Cookie')\n  if (cookieString) {\n    let cookies = cookieString.split(';')\n    cookies.forEach(cookie =\u003e {\n      let cookieName = cookie.split('=')[0].trim()\n      if (cookieName === name) {\n        let cookieVal = cookie.split('=')[1]\n        result = cookieVal\n      }\n    })\n  }\n  return result\n}\n","demos":{"main":{"share_url":"/templates/snippets/cookie_extract","text":"Demo","url":"https://cloudflareworkers.com/#605946f0f09b396361d3dadb5abf29c8:https://tutorial.cloudflareworkers.com/"}},"description":"Extracts the value of a cookie, given the cookie name.","id":"cookie_extract","title":"Extract Cookie Value","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="cors_header_proxy">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/cors_header_proxy>
    <h2>
      CORS Header Proxy
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Add necessary CORS headers to a third party API response</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  const url = new URL(request.url)
  const apiurl = url.searchParams.get(&#39;apiurl&#39;)
  // Rewrite request to point to API url. This also makes the request mutable
  // so we can add the correct Origin header to make the API server think
  // that this request isn&#39;t cross-site.
  request = new Request(apiurl, request)
  request.headers.set(&#39;Origin&#39;, new URL(apiurl).origin)
  let response = await fetch(request)
  // Recreate the response so we can modify the headers
  response = new Response(response.body, response)
  // Set CORS headers
  response.headers.set(&#39;Access-Control-Allow-Origin&#39;, url.origin)
  // Append to/Add Vary header so browser will cache response correctly
  response.headers.append(&#39;Vary&#39;, &#39;Origin&#39;)
  return response
}
function handleOptions(request) {
  // Make sure the necesssary headers are present
  // for this to be a valid pre-flight request
  if (
    request.headers.get(&#39;Origin&#39;) !== null &amp;&amp;
    request.headers.get(&#39;Access-Control-Request-Method&#39;) !== null &amp;&amp;
    request.headers.get(&#39;Access-Control-Request-Headers&#39;) !== null
  ) {
    // Handle CORS pre-flight request.
    // If you want to check the requested method &#43; headers
    // you can do that here.
    return new Response(null, {
      headers: corsHeaders,
    })
  } else {
    // Handle standard OPTIONS request.
    // If you want to allow other HTTP Methods, you can do that here.
    return new Response(null, {
      headers: {
        Allow: &#39;GET, HEAD, POST, OPTIONS&#39;,
      },
    })
  }
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  const request = event.request
  const url = new URL(request.url)
  if (url.pathname.startsWith(proxyEndpoint)) {
    if (request.method === &#39;OPTIONS&#39;) {
      // Handle CORS preflight requests
      event.respondWith(handleOptions(request))
    } else if (
      request.method === &#39;GET&#39; ||
      request.method === &#39;HEAD&#39; ||
      request.method === &#39;POST&#39;
    ) {
      // Handle requests to the API server
      event.respondWith(handleRequest(request))
    } else {
      event.respondWith(async () =&gt; {
        return new Response(null, {
          status: 405,
          statusText: &#39;Method Not Allowed&#39;,
        })
      })
    }
  } else {
    // Serve demo page
    event.respondWith(rawHtmlResponse(demoPage))
  }
})
// We support the GET, POST, HEAD, and OPTIONS methods from any origin,
// and accept the Content-Type header on requests. These headers must be
// present on all responses to all CORS requests. In practice, this means
// all responses to OPTIONS requests.
const corsHeaders = {
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;GET, HEAD, POST, OPTIONS&#39;,
  &#39;Access-Control-Allow-Headers&#39;: &#39;Content-Type&#39;,
}
// The URL for the remote third party API you want to fetch from
// but does not implement CORS
const apiurl = &#39;https://workers-tooling.cf/demos/demoapi&#39;
// The endpoint you want the CORS reverse proxy to be on
const proxyEndpoint = &#39;/corsproxy/&#39;
// The rest of this snippet for the demo page
async function rawHtmlResponse(html) {
  return new Response(html, {
    headers: {
      &#39;content-type&#39;: &#39;text/html;charset=UTF-8&#39;,
    },
  })
}
const demoPage = `
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;h1&gt;API GET without CORS Proxy&lt;/h1&gt;
  &lt;a target=&#39;_blank&#39; href=&#39;https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch#Checking_that_the_fetch_was_successful&#39;&gt;Shows TypeError: Failed to fetch since CORS is misconfigured&lt;/a&gt;
  &lt;p id=&#39;noproxy-status&#39;/&gt;
  &lt;code id=&#39;noproxy&#39;&gt;Waiting&lt;/code&gt;
  &lt;h1&gt;API GET with CORS Proxy&lt;/h1&gt;
  &lt;p id=&#39;proxy-status&#39;/&gt;
  &lt;code id=&#39;proxy&#39;&gt;Waiting&lt;/code&gt;
  &lt;h1&gt;API POST with CORS Proxy &#43; Preflight&lt;/h1&gt;
  &lt;p id=&#39;proxypreflight-status&#39;/&gt;
  &lt;code id=&#39;proxypreflight&#39;&gt;Waiting&lt;/code&gt;
  &lt;script&gt;
  let reqs = {};
  reqs.noproxy = async () =&gt; {
    let response = await fetch(&#39;${apiurl}&#39;)
    return await response.json()
  }
  reqs.proxy = async () =&gt; {
    let response = await fetch(window.location.origin &#43; &#39;${proxyEndpoint}?apiurl=${apiurl}&#39;)
    return await response.json()
  }
  reqs.proxypreflight = async () =&gt; {
    const reqBody = {
      msg: &#34;Hello world!&#34;
    }
    let response = await fetch(window.location.origin &#43; &#39;${proxyEndpoint}?apiurl=${apiurl}&#39;, {
      method: &#34;POST&#34;,
      headers: {
        &#34;Content-Type&#34;: &#34;application/json&#34;
      },
      body: JSON.stringify(reqBody),
    })
    return await response.json()
  }
  (async () =&gt; {
    for (const [reqName, req] of Object.entries(reqs)) {
      try {
        let data = await req()
        document.getElementById(reqName).innerHTML = JSON.stringify(data)
      } catch (e) {
        document.getElementById(reqName).innerHTML = e
      }
    }
  })()
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;`
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  const url = new URL(request.url)\n  const apiurl = url.searchParams.get('apiurl')\n  // Rewrite request to point to API url. This also makes the request mutable\n  // so we can add the correct Origin header to make the API server think\n  // that this request isn't cross-site.\n  request = new Request(apiurl, request)\n  request.headers.set('Origin', new URL(apiurl).origin)\n  let response = await fetch(request)\n  // Recreate the response so we can modify the headers\n  response = new Response(response.body, response)\n  // Set CORS headers\n  response.headers.set('Access-Control-Allow-Origin', url.origin)\n  // Append to/Add Vary header so browser will cache response correctly\n  response.headers.append('Vary', 'Origin')\n  return response\n}\nfunction handleOptions(request) {\n  // Make sure the necesssary headers are present\n  // for this to be a valid pre-flight request\n  if (\n    request.headers.get('Origin') !== null \u0026\u0026\n    request.headers.get('Access-Control-Request-Method') !== null \u0026\u0026\n    request.headers.get('Access-Control-Request-Headers') !== null\n  ) {\n    // Handle CORS pre-flight request.\n    // If you want to check the requested method + headers\n    // you can do that here.\n    return new Response(null, {\n      headers: corsHeaders,\n    })\n  } else {\n    // Handle standard OPTIONS request.\n    // If you want to allow other HTTP Methods, you can do that here.\n    return new Response(null, {\n      headers: {\n        Allow: 'GET, HEAD, POST, OPTIONS',\n      },\n    })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  const request = event.request\n  const url = new URL(request.url)\n  if (url.pathname.startsWith(proxyEndpoint)) {\n    if (request.method === 'OPTIONS') {\n      // Handle CORS preflight requests\n      event.respondWith(handleOptions(request))\n    } else if (\n      request.method === 'GET' ||\n      request.method === 'HEAD' ||\n      request.method === 'POST'\n    ) {\n      // Handle requests to the API server\n      event.respondWith(handleRequest(request))\n    } else {\n      event.respondWith(async () =\u003e {\n        return new Response(null, {\n          status: 405,\n          statusText: 'Method Not Allowed',\n        })\n      })\n    }\n  } else {\n    // Serve demo page\n    event.respondWith(rawHtmlResponse(demoPage))\n  }\n})\n// We support the GET, POST, HEAD, and OPTIONS methods from any origin,\n// and accept the Content-Type header on requests. These headers must be\n// present on all responses to all CORS requests. In practice, this means\n// all responses to OPTIONS requests.\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, HEAD, POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type',\n}\n// The URL for the remote third party API you want to fetch from\n// but does not implement CORS\nconst apiurl = 'https://workers-tooling.cf/demos/demoapi'\n// The endpoint you want the CORS reverse proxy to be on\nconst proxyEndpoint = '/corsproxy/'\n// The rest of this snippet for the demo page\nasync function rawHtmlResponse(html) {\n  return new Response(html, {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  })\n}\nconst demoPage = `\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003cbody\u003e\n  \u003ch1\u003eAPI GET without CORS Proxy\u003c/h1\u003e\n  \u003ca target='_blank' href='https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch#Checking_that_the_fetch_was_successful'\u003eShows TypeError: Failed to fetch since CORS is misconfigured\u003c/a\u003e\n  \u003cp id='noproxy-status'/\u003e\n  \u003ccode id='noproxy'\u003eWaiting\u003c/code\u003e\n  \u003ch1\u003eAPI GET with CORS Proxy\u003c/h1\u003e\n  \u003cp id='proxy-status'/\u003e\n  \u003ccode id='proxy'\u003eWaiting\u003c/code\u003e\n  \u003ch1\u003eAPI POST with CORS Proxy + Preflight\u003c/h1\u003e\n  \u003cp id='proxypreflight-status'/\u003e\n  \u003ccode id='proxypreflight'\u003eWaiting\u003c/code\u003e\n  \u003cscript\u003e\n  let reqs = {};\n  reqs.noproxy = async () =\u003e {\n    let response = await fetch('${apiurl}')\n    return await response.json()\n  }\n  reqs.proxy = async () =\u003e {\n    let response = await fetch(window.location.origin + '${proxyEndpoint}?apiurl=${apiurl}')\n    return await response.json()\n  }\n  reqs.proxypreflight = async () =\u003e {\n    const reqBody = {\n      msg: \"Hello world!\"\n    }\n    let response = await fetch(window.location.origin + '${proxyEndpoint}?apiurl=${apiurl}', {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(reqBody),\n    })\n    return await response.json()\n  }\n  (async () =\u003e {\n    for (const [reqName, req] of Object.entries(reqs)) {\n      try {\n        let data = await req()\n        document.getElementById(reqName).innerHTML = JSON.stringify(data)\n      } catch (e) {\n        document.getElementById(reqName).innerHTML = e\n      }\n    }\n  })()\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e`\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#00ad8fc3ff55f6b740ed09470359dc0d:https://example.com/"}},"description":"Add necessary CORS headers to a third party API response","id":"cors_header_proxy","title":"CORS Header Proxy","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="cache_api">
  <div class="tag-group">
    
    <button class="tooltip Middleware">
      Middleware
      <span class="tooltiptext"></span>
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/cache_api>
    <h2>
      Cache API
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Cache using Cloudflare&rsquo;s <a href="https://developers.cloudflare.com/workers/reference/apis/cache/">Cache API</a>. This example can cache POST requests as well as change what hostname to store a response in cache. Note the previewer is not avalible for using Cache API.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(event) {
  let request = event.request
  let cacheUrl = new URL(request.url)
  // hostname for a different zone
  cacheUrl.hostname = someOtherHostname
  let cacheKey = new Request(cacheUrl, request)
  let cache = caches.default
  // Get this request from this zone&#39;s cache
  let response = await cache.match(cacheKey)
  if (!response) {
    //if not in cache, grab it from the origin
    response = await fetch(request)
    // must use Response constructor to inherit all of response&#39;s fields
    response = new Response(response.body, response)
    // Cache API respects Cache-Control headers, so by setting max-age to 10
    // the response will only live in cache for max of 10 seconds
    response.headers.append(&#39;Cache-Control&#39;, &#39;max-age=10&#39;)
    // store the fetched response as cacheKey
    // use waitUntil so computational expensive tasks don&#39;t delay the response
    event.waitUntil(cache.put(cacheKey, response.clone()))
  }
  return response
}
async function handlePostRequest(event) {
  let request = event.request
  let body = await request.clone().text()
  let hash = await sha256(body)
  let cacheUrl = new URL(request.url)
  // get/store the URL in cache by prepending the body&#39;s hash
  cacheUrl.pathname = &#39;/posts&#39; &#43; cacheUrl.pathname &#43; hash
  // Convert to a GET to be able to cache
  let cacheKey = new Request(cacheUrl, {
    headers: request.headers,
    method: &#39;GET&#39;,
  })
  let cache = caches.default
  //try to find the cache key in the cache
  let response = await cache.match(cacheKey)
  // otherwise, fetch response to POST request from origin
  if (!response) {
    response = await fetch(request)
    event.waitUntil(cache.put(cacheKey, response))
  }
  return response
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  try {
    let request = event.request
    if (request.method.toUpperCase() === &#39;POST&#39;)
      return event.respondWith(handlePostRequest(event))
    return event.respondWith(handleRequest(event))
  } catch (e) {
    return event.respondWith(new Response(&#39;Error thrown &#39; &#43; e.message))
  }
})
async function sha256(message) {
  // encode as UTF-8
  const msgBuffer = new TextEncoder().encode(message)
  // hash the message
  const hashBuffer = await crypto.subtle.digest(&#39;SHA-256&#39;, msgBuffer)
  // convert ArrayBuffer to Array
  const hashArray = Array.from(new Uint8Array(hashBuffer))
  // convert bytes to hex string
  const hashHex = hashArray.map(b =&gt; (&#39;00&#39; &#43; b.toString(16)).slice(-2)).join(&#39;&#39;)
  return hashHex
}
const someOtherHostname = &#39;my.herokuapp.com&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(event) {\n  let request = event.request\n  let cacheUrl = new URL(request.url)\n  // hostname for a different zone\n  cacheUrl.hostname = someOtherHostname\n  let cacheKey = new Request(cacheUrl, request)\n  let cache = caches.default\n  // Get this request from this zone's cache\n  let response = await cache.match(cacheKey)\n  if (!response) {\n    //if not in cache, grab it from the origin\n    response = await fetch(request)\n    // must use Response constructor to inherit all of response's fields\n    response = new Response(response.body, response)\n    // Cache API respects Cache-Control headers, so by setting max-age to 10\n    // the response will only live in cache for max of 10 seconds\n    response.headers.append('Cache-Control', 'max-age=10')\n    // store the fetched response as cacheKey\n    // use waitUntil so computational expensive tasks don't delay the response\n    event.waitUntil(cache.put(cacheKey, response.clone()))\n  }\n  return response\n}\nasync function handlePostRequest(event) {\n  let request = event.request\n  let body = await request.clone().text()\n  let hash = await sha256(body)\n  let cacheUrl = new URL(request.url)\n  // get/store the URL in cache by prepending the body's hash\n  cacheUrl.pathname = '/posts' + cacheUrl.pathname + hash\n  // Convert to a GET to be able to cache\n  let cacheKey = new Request(cacheUrl, {\n    headers: request.headers,\n    method: 'GET',\n  })\n  let cache = caches.default\n  //try to find the cache key in the cache\n  let response = await cache.match(cacheKey)\n  // otherwise, fetch response to POST request from origin\n  if (!response) {\n    response = await fetch(request)\n    event.waitUntil(cache.put(cacheKey, response))\n  }\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  try {\n    let request = event.request\n    if (request.method.toUpperCase() === 'POST')\n      return event.respondWith(handlePostRequest(event))\n    return event.respondWith(handleRequest(event))\n  } catch (e) {\n    return event.respondWith(new Response('Error thrown ' + e.message))\n  }\n})\nasync function sha256(message) {\n  // encode as UTF-8\n  const msgBuffer = new TextEncoder().encode(message)\n  // hash the message\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer)\n  // convert ArrayBuffer to Array\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  // convert bytes to hex string\n  const hashHex = hashArray.map(b =\u003e ('00' + b.toString(16)).slice(-2)).join('')\n  return hashHex\n}\nconst someOtherHostname = 'my.herokuapp.com'\n","description":"Cache using Cloudflare's [Cache API](/reference/apis/cache/). This example can cache POST requests as well as change what hostname to store a response in cache. Note the previewer is not avalible for using Cache API.","id":"cache_api","tags":["Middleware"],"title":"Cache API","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="auth_with_headers">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/auth_with_headers>
    <h2>
      Auth with headers
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Allow or deny a request based on a known pre-shared key in a header. Note while this simple implementation is helpful, it is not meant to replace more secure scripts such as signed requests using the <a href="https://developers.cloudflare.com/workers/reference/runtime/apis/web-crypto">WebCrypto API</a>.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  let psk = request.headers.get(PRESHARED_AUTH_HEADER_KEY)
  if (psk === PRESHARED_AUTH_HEADER_VALUE) {
    // Correct preshared header key supplied. Fetching request
    // from origin
    return fetch(request)
  }
  // Incorrect key rejecting request
  return new Response(&#39;Sorry, you have supplied an invalid key.&#39;, {
    status: 403,
  })
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * @param {string} PRESHARED_AUTH_HEADER_KEY custom header to check for key
 * @param {string} PRESHARED_AUTH_HEADER_VALUE hard coded key value
 */
const PRESHARED_AUTH_HEADER_KEY = &#39;X-Custom-PSK&#39;
const PRESHARED_AUTH_HEADER_VALUE = &#39;mypresharedkey&#39;
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  let psk = request.headers.get(PRESHARED_AUTH_HEADER_KEY)\n  if (psk === PRESHARED_AUTH_HEADER_VALUE) {\n    // Correct preshared header key supplied. Fetching request\n    // from origin\n    return fetch(request)\n  }\n  // Incorrect key rejecting request\n  return new Response('Sorry, you have supplied an invalid key.', {\n    status: 403,\n  })\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * @param {string} PRESHARED_AUTH_HEADER_KEY custom header to check for key\n * @param {string} PRESHARED_AUTH_HEADER_VALUE hard coded key value\n */\nconst PRESHARED_AUTH_HEADER_KEY = 'X-Custom-PSK'\nconst PRESHARED_AUTH_HEADER_VALUE = 'mypresharedkey'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#7373b8c3c9c46c03c81562f00f663f81:https://tutorial.cloudflareworkers.com"}},"description":"Allow or deny a request based on a known pre-shared key in a header. Note while this simple implementation is helpful, it is not meant to replace more secure scripts such as signed requests using the [WebCrypto API](/reference/runtime/apis/web-crypto).","id":"auth_with_headers","title":"Auth with headers","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="alter_headers">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/alter_headers>
    <h2>
      Alter Headers
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Change the headers sent in a request or returned in a response</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  // Make the headers mutable by re-constructing the Request.
  request = new Request(request)
  request.headers.set(&#39;x-my-header&#39;, &#39;custom value&#39;)
  const URL = &#39;https://workers-tooling.cf/demos/static/html&#39;
  // URL is set up to respond with dummy HTML, remove to send requests to your own origin
  let response = await fetch(URL, request)
  // Make the headers mutable by re-constructing the Response.
  response = new Response(response.body, response)
  response.headers.set(&#39;x-my-header&#39;, &#39;custom value&#39;)
  return response
}
addEventListener(&#39;fetch&#39;, event =&gt; {
  event.respondWith(handleRequest(event.request))
})
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  // Make the headers mutable by re-constructing the Request.\n  request = new Request(request)\n  request.headers.set('x-my-header', 'custom value')\n  const URL = 'https://workers-tooling.cf/demos/static/html'\n  // URL is set up to respond with dummy HTML, remove to send requests to your own origin\n  let response = await fetch(URL, request)\n  // Make the headers mutable by re-constructing the Response.\n  response = new Response(response.body, response)\n  response.headers.set('x-my-header', 'custom value')\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"share_url":"/templates/snippets/alter_headers","text":"Demo","url":"https://cloudflareworkers.com/#5386d315ec8c899370e8e5d00cf88939:https://tutorial.cloudflareworkers.com"}},"description":"Change the headers sent in a request or returned in a response","id":"alter_headers","title":"Alter Headers","type":"snippet","weight":1}
    </script>
    
    <figure class="template-card snippet" id="redirect">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/redirect>
    <h2>
      Redirect
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Redirect a request by sending a 301 or 302 HTTP response</p>
  <div class="copy-group">
    <div class="copy-step">
      <img id="img" type="image/svg+xml" src="https://developers.cloudflare.com/workers/templates/media/file.svg" />
      <span>Copy into a Worker script:</span>
    </div>
    <div class="copy">
      <code>async function handleRequest(request) {
  return Response.redirect(someURLToRedirectTo, code)
}
addEventListener(&#39;fetch&#39;, async event =&gt; {
  event.respondWith(handleRequest(event.request))
})
/**
 * Example Input
 * @param {Request} url where to redirect the response
 * @param {number?=301|302} type permanent or temporary redirect
 */
const someURLToRedirectTo = &#39;https://www.google.com&#39;
const code = 301
</code>
    </div>
  </div>
</figure>
    <script type="application/json" id="snippets">
      {"code":"async function handleRequest(request) {\n  return Response.redirect(someURLToRedirectTo, code)\n}\naddEventListener('fetch', async event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Example Input\n * @param {Request} url where to redirect the response\n * @param {number?=301|302} type permanent or temporary redirect\n */\nconst someURLToRedirectTo = 'https://www.google.com'\nconst code = 301\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#ab385d4c4e43608684889eaa390d4218:https://example.com/"}},"description":"Redirect a request by sending a 301 or 302 HTTP response","id":"redirect","title":"Redirect","type":"snippet","weight":1}
    </script>
    
  </section>
  
  
  <h2 style="padding-bottom: 20px">Featured</h2>
  <section class="template-wrapper featured">
    
    <div class="template_result" id="cloud_storage">
      <figure class="template-card boilerplate" id="cloud_storage">
  <div class="tag-group">
    
    <button class="tooltip Middleware">
      <span class="tooltiptext"></span>Middleware
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/cloud_storage>
    <h2>
      Cloud Storage
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Serve private AWS bucket files from a Worker script</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/conzorkingkong/cloud-storage">https://github.com/conzorkingkong/cloud-storage</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="graphql_server">
      <figure class="template-card boilerplate" id="graphql_server">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/graphql_server>
    <h2>
      Apollo GraphQL Server
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>ðŸ”¥Lightning-fast, globally distributed Apollo GraphQL server, deployed at the edge using Cloudflare Workers.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/signalnerve/workers-graphql-server">https://github.com/signalnerve/workers-graphql-server</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="speedtest_worker">
      <figure class="template-card boilerplate" id="speedtest_worker">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/speedtest_worker>
    <h2>
      Speedtest
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Measure download / upload connection speed from the client side, using the Performance Timing API</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/cloudflare/worker-speedtest-template">https://github.com/cloudflare/worker-speedtest-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="binast_cf_worker">
      <figure class="template-card boilerplate" id="binast_cf_worker">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/binast_cf_worker>
    <h2>
      Binast-Cf-Worker
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Serve BinAST via a Cloudflare Worker</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/xtuc/binast-cf-worker-template">https://github.com/xtuc/binast-cf-worker-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="img_color_worker">
      <figure class="template-card boilerplate" id="img_color_worker">
  <div class="tag-group">
    
    <button class="tooltip Middleware">
      <span class="tooltiptext"></span>Middleware
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/img_color_worker>
    <h2>
      Img-Color-Worker
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Retrieve the dominant color of a PNG or JPEG image</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/xtuc/img-color-worker">https://github.com/xtuc/img-color-worker</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="sites">
      <figure class="template-card boilerplate" id="sites">
  <div class="tag-group">
    
    <button class="tooltip Originless">
      <span class="tooltiptext"></span>Originless
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/sites>
    <h2>
      Worker Sites
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Get started with Workers Sites to easily deploy static assets to the Cloudflare edge.</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/cloudflare/worker-sites-template">https://github.com/cloudflare/worker-sites-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="emscripten">
      <figure class="template-card boilerplate" id="emscripten">
  <div class="tag-group">
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/emscripten>
    <h2>
      Emscripten &#43; Wasm Image Resizer
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Image Resizer in C compiled to Wasm with Emscripten</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/cloudflare/worker-emscripten-template">https://github.com/cloudflare/worker-emscripten-template</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
    <div class="template_result" id="sentry">
      <figure class="template-card boilerplate" id="sentry">
  <div class="tag-group">
    
    <button class="tooltip Middleware">
      <span class="tooltiptext"></span>Middleware
    </button>
    
  </div>
  
  
  
  
  
  
  <a href=https://developers.cloudflare.com/workers/templates/pages/sentry>
    <h2>
      Sentry
    </h2>
    <img src="https://developers.cloudflare.com/workers/templates/media/right-arrow.svg"/>
  </a>
  <p>Log exceptions and errors in your Workers application to Sentry.io -  an error tracking tool</p>
  <div class="copy-group">
    <div class="copy-step">
      <img src="https://developers.cloudflare.com/workers/templates/media/terminal.svg" id="img" />
      <span>Paste this into your terminal:</span>
    </div>
    <div class="copy">
      <code>
        wrangler generate my-app
        <a href="https://github.com/bustle/cf-sentry">https://github.com/bustle/cf-sentry</a>
      </code>
    </div>
  </div>
</figure>
    </div>
    
  </section>
  
  <script type="application/json" id="templates">
    [{"code":"async function handleRequest(request) {\n  try {\n    let tlsVersion = request.cf.tlsVersion\n    // Allow only TLS versions 1.2 and 1.3\n    if (tlsVersion != 'TLSv1.2' \u0026\u0026 tlsVersion != 'TLSv1.3') {\n      return new Response('Please use TLS version 1.2 or higher.', {\n        status: 403,\n      })\n    }\n    return fetch(request)\n  } catch (err) {\n    console.error(\n      'request.cf does not exist in the previewer, only in production',\n    )\n    return new Response('Error in workers script' + err.message, {\n      status: 500,\n    })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","description":"Inspects the incoming request's TLS version and blocks if under TLSv1.2.","id":"block_on_tls_version","tags":["Middleware"],"title":"Block on TLS Version","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  let psk = request.headers.get(PRESHARED_AUTH_HEADER_KEY)\n  if (psk === PRESHARED_AUTH_HEADER_VALUE) {\n    // Correct preshared header key supplied. Fetching request\n    // from origin\n    return fetch(request)\n  }\n  // Incorrect key rejecting request\n  return new Response('Sorry, you have supplied an invalid key.', {\n    status: 403,\n  })\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * @param {string} PRESHARED_AUTH_HEADER_KEY custom header to check for key\n * @param {string} PRESHARED_AUTH_HEADER_VALUE hard coded key value\n */\nconst PRESHARED_AUTH_HEADER_KEY = 'X-Custom-PSK'\nconst PRESHARED_AUTH_HEADER_VALUE = 'mypresharedkey'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#7373b8c3c9c46c03c81562f00f663f81:https://tutorial.cloudflareworkers.com"}},"description":"Allow or deny a request based on a known pre-shared key in a header. Note while this simple implementation is helpful, it is not meant to replace more secure scripts such as signed requests using the [WebCrypto API](/reference/runtime/apis/web-crypto).","id":"auth_with_headers","title":"Auth with headers","type":"snippet","weight":1},{"code":"const LOG_URL = 'https://log-service.example.com/' // Service setup up to receive logs\nasync function handleRequest(event) {\n  let response\n  try {\n    response = await fetch(event.request)\n    if (!response.ok) {\n      let body = await response.text()\n      throw new Error(\n        'Bad response at origin. Status: ' +\n          response.status +\n          ' Body: ' +\n          body.trim().substring(0, 10), //ensures is string that can be a header\n      )\n    }\n  } catch (err) {\n    // Without event.waitUntil(), our fetch() to our logging service may\n    // or may not complete.\n    event.waitUntil(postLog(err))\n    const stack = JSON.stringify(err.stack) || err\n    // Copy the response and initialize body to the stack trace\n    response = new Response(stack, response)\n    // Shove our rewritten URL into a header to find out what it was.\n    response.headers.set('X-Debug-stack', stack)\n    response.headers.set('X-Debug-err', err)\n  }\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  //Have any uncaught errors thrown go directly to origin\n  event.passThroughOnException()\n  event.respondWith(handleRequest(event))\n})\nfunction postLog(data) {\n  return fetch(LOG_URL, {\n    method: 'POST',\n    body: data,\n  })\n}\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#5601380cdcb173e5b712bd82113ce47a:https://blah.workers-tooling.cf/fetch/error"}},"description":"Send debug information in an errored response and to a logging service.","id":"debugging_tips","share_url":"/about/tips/debugging","tags":["Middleware"],"title":"Debugging Tips","type":"snippet","weight":50},{"code":"const BLOCKED_HOSTNAMES = ['nope.mywebsite.com', 'bye.website.com']\nasync function handleRequest(request) {\n  // Return a new Response based on..\n  // On URL's hostname\n  let url = new URL(request.url)\n  if (BLOCKED_HOSTNAMES.includes(url.hostname)) {\n    return new Response('Blocked Host', { status: 403 })\n  }\n  // On URL's file extenstion (e.g. block paths ending in .doc or .xml)\n  let forbiddenExtRegExp = new RegExp(/\\.(doc|xml)$/)\n  if (forbiddenExtRegExp.test(url.pathname)) {\n    return new Response('Blocked Extension', { status: 403 })\n  }\n  // On HTTP method\n  if (request.method === 'POST') {\n    return new Response('Response for POST')\n  }\n  // On User Agent\n  let userAgent = request.headers.get('User-Agent') || ''\n  if (userAgent.includes('bot')) {\n    return new Response('Block User Agent containing bot', { status: 403 })\n  }\n  // On Client's IP address\n  let clientIP = request.headers.get('CF-Connecting-IP')\n  if (clientIP === '1.2.3.4') {\n    return new Response('Block the IP 1.2.3.4', { status: 403 })\n  }\n  // On ASN\n  if ((request.cf || {}).asn == 64512) {\n    return new Response('Block the ASN 64512 response')\n  }\n  // On Device Type\n  //  Requires Enterprise \"CF-Device-Type Header\" zone setting or\n  //  Page Rule with \"Cache By Device Type\" setting applied.\n  let device = request.headers.get('CF-Device-Type')\n  if (device === 'mobile') {\n    return Response.redirect('https://mobile.example.com')\n  }\n  console.error(\n    \"Getting Client's IP address, device type, and ASN are not supported in playground. Must test on a live worker\",\n  )\n  return fetch(request)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"share_url":"/templates/snippets/conditional_response","tags":["Enterprise"],"text":"Demo","url":"https://cloudflareworkers.com/#cec6695f67232bc76e3f396fcb2d5cc7:https://nope.mywebsite.com/"}},"description":"Return a response based on the incoming request's URL, HTTP method, User Agent, IP address, ASN or device type (e.g. mobile)","id":"conditional_response","title":"Conditional Response","type":"snippet","weight":60},{"code":"async function handleRequest(request) {\n  const url = new URL(request.url)\n  const apiurl = url.searchParams.get('apiurl')\n  // Rewrite request to point to API url. This also makes the request mutable\n  // so we can add the correct Origin header to make the API server think\n  // that this request isn't cross-site.\n  request = new Request(apiurl, request)\n  request.headers.set('Origin', new URL(apiurl).origin)\n  let response = await fetch(request)\n  // Recreate the response so we can modify the headers\n  response = new Response(response.body, response)\n  // Set CORS headers\n  response.headers.set('Access-Control-Allow-Origin', url.origin)\n  // Append to/Add Vary header so browser will cache response correctly\n  response.headers.append('Vary', 'Origin')\n  return response\n}\nfunction handleOptions(request) {\n  // Make sure the necesssary headers are present\n  // for this to be a valid pre-flight request\n  if (\n    request.headers.get('Origin') !== null \u0026\u0026\n    request.headers.get('Access-Control-Request-Method') !== null \u0026\u0026\n    request.headers.get('Access-Control-Request-Headers') !== null\n  ) {\n    // Handle CORS pre-flight request.\n    // If you want to check the requested method + headers\n    // you can do that here.\n    return new Response(null, {\n      headers: corsHeaders,\n    })\n  } else {\n    // Handle standard OPTIONS request.\n    // If you want to allow other HTTP Methods, you can do that here.\n    return new Response(null, {\n      headers: {\n        Allow: 'GET, HEAD, POST, OPTIONS',\n      },\n    })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  const request = event.request\n  const url = new URL(request.url)\n  if (url.pathname.startsWith(proxyEndpoint)) {\n    if (request.method === 'OPTIONS') {\n      // Handle CORS preflight requests\n      event.respondWith(handleOptions(request))\n    } else if (\n      request.method === 'GET' ||\n      request.method === 'HEAD' ||\n      request.method === 'POST'\n    ) {\n      // Handle requests to the API server\n      event.respondWith(handleRequest(request))\n    } else {\n      event.respondWith(async () =\u003e {\n        return new Response(null, {\n          status: 405,\n          statusText: 'Method Not Allowed',\n        })\n      })\n    }\n  } else {\n    // Serve demo page\n    event.respondWith(rawHtmlResponse(demoPage))\n  }\n})\n// We support the GET, POST, HEAD, and OPTIONS methods from any origin,\n// and accept the Content-Type header on requests. These headers must be\n// present on all responses to all CORS requests. In practice, this means\n// all responses to OPTIONS requests.\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Methods': 'GET, HEAD, POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type',\n}\n// The URL for the remote third party API you want to fetch from\n// but does not implement CORS\nconst apiurl = 'https://workers-tooling.cf/demos/demoapi'\n// The endpoint you want the CORS reverse proxy to be on\nconst proxyEndpoint = '/corsproxy/'\n// The rest of this snippet for the demo page\nasync function rawHtmlResponse(html) {\n  return new Response(html, {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  })\n}\nconst demoPage = `\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003cbody\u003e\n  \u003ch1\u003eAPI GET without CORS Proxy\u003c/h1\u003e\n  \u003ca target='_blank' href='https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch#Checking_that_the_fetch_was_successful'\u003eShows TypeError: Failed to fetch since CORS is misconfigured\u003c/a\u003e\n  \u003cp id='noproxy-status'/\u003e\n  \u003ccode id='noproxy'\u003eWaiting\u003c/code\u003e\n  \u003ch1\u003eAPI GET with CORS Proxy\u003c/h1\u003e\n  \u003cp id='proxy-status'/\u003e\n  \u003ccode id='proxy'\u003eWaiting\u003c/code\u003e\n  \u003ch1\u003eAPI POST with CORS Proxy + Preflight\u003c/h1\u003e\n  \u003cp id='proxypreflight-status'/\u003e\n  \u003ccode id='proxypreflight'\u003eWaiting\u003c/code\u003e\n  \u003cscript\u003e\n  let reqs = {};\n  reqs.noproxy = async () =\u003e {\n    let response = await fetch('${apiurl}')\n    return await response.json()\n  }\n  reqs.proxy = async () =\u003e {\n    let response = await fetch(window.location.origin + '${proxyEndpoint}?apiurl=${apiurl}')\n    return await response.json()\n  }\n  reqs.proxypreflight = async () =\u003e {\n    const reqBody = {\n      msg: \"Hello world!\"\n    }\n    let response = await fetch(window.location.origin + '${proxyEndpoint}?apiurl=${apiurl}', {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(reqBody),\n    })\n    return await response.json()\n  }\n  (async () =\u003e {\n    for (const [reqName, req] of Object.entries(reqs)) {\n      try {\n        let data = await req()\n        document.getElementById(reqName).innerHTML = JSON.stringify(data)\n      } catch (e) {\n        document.getElementById(reqName).innerHTML = e\n      }\n    }\n  })()\n  \u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e`\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#00ad8fc3ff55f6b740ed09470359dc0d:https://example.com/"}},"description":"Add necessary CORS headers to a third party API response","id":"cors_header_proxy","title":"CORS Header Proxy","type":"snippet","weight":1},{"demos":{"main":{"tags":["Wasm"],"text":"Demo","url":"https://cloudflareworkers.com/#ddb7fa39e09cdf734180c5d083ddb390:http://placehold.jp/1200x800.png"}},"description":"Image Resizer in C compiled to Wasm with Emscripten","id":"emscripten","repository_url":"https://github.com/cloudflare/worker-emscripten-template","title":"Emscripten + Wasm Image Resizer","type":"featured_boilerplate","weight":1},{"code":"async function handleRequest(request) {\n  let url = new URL(request.url)\n  // Only use the path for the cache key, removing query strings\n  // and always storing HTTPS e.g. https://www.example.com/file-uri-here\n  let someCustomKey = `https://${url.hostname}${url.pathname}`\n  let response = await fetch(request, {\n    cf: {\n      // Tell Cloudflare's Global CDN to always cache this fetch regardless of content type\n      // for a max of 5 seconds before revalidating the resource\n      cacheTtl: 5, // sets TTL to 5 and cacheEverything setting\n      //Enterprise only feature, see Cache API for other plans\n      cacheKey: someCustomKey,\n    },\n  })\n  // must use Response constructor to inherit all of response's fields\n  response = new Response(response.body, response)\n  //Set cache control headers to cache on browser for 25 minutes\n  response.headers.set('Cache-Control', 'max-age=1500')\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"tags":["Middleware","Enterprise"],"text":"Demo","url":"https://cloudflareworkers.com/#8dd3e29985701b05e43b4dd74c387b74:https://example.com/"}},"description":"Determine how/if Cloudflare's [Classic CDN](/about/using-cache.md#cloudflare-s-cdn) and Browsers will cache a resource by setting TTLs, cache keys, and cache settings.","id":"cache_ttl","title":"Cache TTL and Custom Keys","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  const NAME = 'experiment-0'\n  // Responses below are place holders, you could set up\n  // a custom path for each test (e.g. /control/somepath )\n  const TEST_RESPONSE = new Response('Test group') // fetch('/test/sompath', request)\n  const CONTROL_RESPONSE = new Response('Control group') // fetch('/control/sompath', request)\n  // Determine which group this requester is in.\n  const cookie = request.headers.get('cookie')\n  if (cookie \u0026\u0026 cookie.includes(`${NAME}=control`)) {\n    return CONTROL_RESPONSE\n  } else if (cookie \u0026\u0026 cookie.includes(`${NAME}=test`)) {\n    return TEST_RESPONSE\n  } else {\n    // if no cookie then this is a new client, decide a group and set the cookie\n    let group = Math.random() \u003c 0.5 ? 'test' : 'control' // 50/50 split\n    let response = group === 'control' ? CONTROL_RESPONSE : TEST_RESPONSE\n    response.headers.append('Set-Cookie', `${NAME}=${group}; path=/`)\n    return response\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#12a2962014e1324e3a416a5a76e1f81f:https://tutorial.cloudflareworkers.com"}},"description":"Set up an A/B test by controlling what response is served based on cookies","id":"ab_testing","share_url":"/templates/snippets/ab_testing","title":"A/B Testing","type":"snippet","weight":1},{"description":"Measure download / upload connection speed from the client side, using the Performance Timing API","id":"speedtest_worker","repository_url":"https://github.com/cloudflare/worker-speedtest-template","title":"Speedtest","type":"featured_boilerplate","weight":1},{"code":"const HOMEPAGE_URL = 'https://tutorial.cloudflareworkers.com/'\nconst PROTECTED_TYPE = 'images/'\nasync function handleRequest(request) {\n  // Fetch the original request\n  let response = await fetch(request)\n  // If it's an image, engage hotlink protection based on the\n  // Referer header.\n  let referer = request.headers.get('Referer')\n  let contentType = response.headers.get('Content-Type') || ''\n  if (referer \u0026\u0026 contentType.startsWith(PROTECTED_TYPE)) {\n    // If the hostnames don't match, it's a hotlink\n    if (new URL(referer).hostname !== new URL(request.url).hostname) {\n      // Redirect the user to your website\n      return Response.redirect(url, 302)\n    }\n  }\n  // Everything is fine, return the response normally.\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"share_url":"/templates/snippets/hotlink-protection","text":"Demo","url":"https://cloudflareworkers.com/#d659b20dcf91df6e6de1bedbb94f6702:https://www.cloudflare.com/img/logo-cloudflare-dark.svg"}},"description":"Block other websites from linking to your content","id":"hot_link_protection","title":"Hot-link Protection","type":"snippet","weight":1},{"demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#6626eb50f7b53c2d42b79d1082b9bd37:https://tutorial.cloudflareworkers.com"}},"description":"Simple Hello World in JS","id":"hello_world","repository_url":"https://github.com/cloudflare/worker-template","title":"Hello World","type":"boilerplate","weight":99},{"code":"async function handlePostRequest(request) {\n  let reqBody = await readRequestBody(request)\n  let retBody = `The request body sent in was ${reqBody}`\n  return new Response(retBody)\n}\nasync function handleRequest(request) {\n  let retBody = `The request was a GET `\n  return new Response(retBody)\n}\naddEventListener('fetch', event =\u003e {\n  const { request } = event\n  const { url } = request\n  if (url.includes('form')) {\n    return event.respondWith(rawHtmlResponse(someForm))\n  }\n  if (request.method === 'POST') {\n    return event.respondWith(handlePostRequest(request))\n  } else if (request.method === 'GET') {\n    return event.respondWith(handleRequest(request))\n  }\n})\n/**\n * rawHtmlResponse delievers a response with HTML inputted directly\n * into the worker script\n * @param {string} html\n */\nasync function rawHtmlResponse(html) {\n  const init = {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  }\n  return new Response(html, init)\n}\n/**\n * readRequestBody reads in the incoming request body\n * Use await readRequestBody(..) in an async function to get the string\n * @param {Request} request the incoming request to read from\n */\nasync function readRequestBody(request) {\n  const { headers } = request\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    const body = await request.json()\n    return JSON.stringify(body)\n  } else if (contentType.includes('application/text')) {\n    const body = await request.text()\n    return body\n  } else if (contentType.includes('text/html')) {\n    const body = await request.text()\n    return body\n  } else if (contentType.includes('form')) {\n    const formData = await request.formData()\n    let body = {}\n    for (let entry of formData.entries()) {\n      body[entry[0]] = entry[1]\n    }\n    return JSON.stringify(body)\n  } else {\n    let myBlob = await request.blob()\n    var objectURL = URL.createObjectURL(myBlob)\n    return objectURL\n  }\n}\nconst someForm = `\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\u003cbody\u003e\n\u003ch1\u003eHello World\u003c/h1\u003e\n\u003cp\u003eThis is all generated using a Worker\u003c/p\u003e\n\u003cform action=\"/demos/requests\" method=\"post\"\u003e\n  \u003cdiv\u003e\n    \u003clabel for=\"say\"\u003eWhat  do you want to say?\u003c/label\u003e\n    \u003cinput name=\"say\" id=\"say\" value=\"Hi\"\u003e\n  \u003c/div\u003e\n  \u003cdiv\u003e\n    \u003clabel for=\"to\"\u003eTo who?\u003c/label\u003e\n    \u003cinput name=\"to\" id=\"to\" value=\"Mom\"\u003e\n  \u003c/div\u003e\n  \u003cdiv\u003e\n    \u003cbutton\u003eSend my greetings\u003c/button\u003e\n  \u003c/div\u003e\n\u003c/form\u003e\n\u003c/body\u003e\n\u003c/html\u003e\n","demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#a6a285e4e2bfbebea0be31b9eeaca3e6:https://example.com/form"}},"description":"Serves an HTML form, then reads POSTs from that form data. Can also be used to read JSON or other POST data from an incoming request.","id":"post_data","title":"Read POST Data","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  return redirect(request, 'subdomain')\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Returns a redirect determined by the country code\n * @param {Request} request\n */\nfunction redirect(request) {\n  // The `cf-ipcountry` header is not supported in the previewer\n  const country = request.headers.get('cf-ipcountry')\n  const url = countryMap[country]\n  return Response.redirect(url)\n}\n/**\n * A map of the url's to redirect to\n * @param {Object} countryMap\n*/\nconst countryMap = {\n  \"US\" : \"https://example.com/us\",\n  \"EU\": \"https://eu.example.com/\"\n}\n","description":"Redirect a response based on the country code of the visitor","id":"country_code","tags":["Originless"],"title":"Country Code","type":"snippet","weight":20},{"code":"async function handleRequest(request) {\n  /**\n   * Best practice is to only assign properties on the response\n   * object (i.e. ResponseInit props) through either a method or the constructor\n   * since properties are immutable\n   */\n  let originalResponse = await fetch(request)\n  let originalBody = await originalResponse.json()\n  // Change status and statusText\n  // Make sure to pass in originalResponse to preserving all parts\n  // of the original response except the part we want to update.\n  let response = new Response(originalResponse, { status: 500, statusText: 'some message' })\n  // Change response body by adding the foo prop\n  let body = JSON.stringify({ foo: 'bar', ...originalBody })\n  response = new Response(body, response)\n  // Add a header using set method\n  response.headers.set('foo', 'bar')\n  // Set destination header to the value of the source header\n  if (response.headers.has(headerNameSrc)) {\n    response.headers.set(headerNameDst, response.headers.get(headerNameSrc))\n    console.log(\n      `Response header \"${headerNameDst}\" was set to \"${response.headers.get(headerNameDst)}\"`,\n    )\n  }\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * @param {string} headerNameSrc the header to get the new value from\n * @param {string} headerNameDst the header to set based off of value in src\n */\nconst headerNameSrc = 'foo'//'Orig-Header'\nconst headerNameDst = 'Last-Modified'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#daf0e96ae0ff4ce3f103c14bf6d968df:http://workers-tooling.cf/demos/static/json"}},"description":"Recommended practice for mutating a fetched [response](/reference/apis/response). First, fetches a request then modifies specific properties which are immutable: `status`, `statusText`, `headers` and `body`.","id":"modify_res_props","title":"Modify Response","type":"snippet","weight":1},{"code":"const SOME_HOOK_SERVER = 'https://webhook.flow-wolf.io/hook'\nconst DEBUG = true\n/**\n * Define personal data with regular expressions\n * Respond with block if credit card data, and strip\n * emails and phone numbers from the response\n * Execution will be limited to MIME type \"text/*\"\n */\nasync function handleRequest(request) {\n  let response = await fetch(request)\n  // Return origin responst, if response wasn't text\n  let contentType = response.headers.get('content-type')\n  if (!contentType.toLowerCase().includes('text/')) {\n    return response\n  }\n  let text = await response.text()\n  text = DEBUG\n    ? // for testing only - replace the response from the origin with an email\n      text.replace('You may use this', 'me@example.com may use this')\n    : text\n  const sensitiveRegexsMap = {\n    email: String.raw`\\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}\\b`,\n    phone: String.raw`\\b07\\d{9}\\b`,\n    creditCard: String.raw`\\b(?:4[0-9]{12}(?:[0-9]{3})?|(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\\d{3})\\d{11})\\b`,\n  }\n  for (const kind in sensitiveRegexsMap) {\n    let sensitiveRegex = new RegExp(sensitiveRegexsMap[kind], 'ig')\n    let match = await sensitiveRegex.test(text)\n    if (match) {\n      // alert a data breach by posting to a webhook server\n      await postDataBreach(request)\n      // respond with a block if credit card, else replace\n      // senstive text with *'s\n      return kind === 'creditCard'\n        ? new Response(kind + ' found\\nForbidden\\n', {\n            status: 403,\n            statusText: 'Forbidden',\n          })\n        : new Response(text.replace(sensitiveRegex, '**********'), response)\n    }\n  }\n  return new Response(text, response)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\nasync function postDataBreach(request) {\n  let trueClientIp = request.headers.get('cf-connecting-ip')\n  let epoch = new Date().getTime()\n  const body = {\n    ip: trueClientIp,\n    time: epoch,\n    request: request,\n  }\n  const init = {\n    body: JSON.stringify(body),\n    method: 'POST',\n    headers: {\n      'content-type': 'application/json;charset=UTF-8',\n    },\n  }\n  return await fetch(SOME_HOOK_SERVER, init)\n}\n","demos":{"main":{"share_url":"/templates/snippets/private_data_loss","tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#1b7ac657cfaec2635a319441800a5158:https://example.com/"}},"description":"Prevent access to personal and sensitive data by inspecting response data from an origin server. In this example, sensitive data is defined by regexes for email, UK mobile number, or credit card number. If a match is detected, trigger a data breach alert and respond with either a block or the data stripped from the response.","id":"private_data_loss","title":"Data Loss Prevention","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  }\n  const response = await fetch(url, init)\n  const results = await gatherResponse(response)\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost at url is set up to respond with HTML\n * Replace url with the host you wish to send requests to\n *  */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url = someHost + '/static/html'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#14a82a672534b0dd25b385a5d3de744c:https://example.com"}},"description":"Sends a request to a remote server, reads HTML from the response, then serves that HTML.","id":"fetch_html","title":"Fetch HTML","type":"snippet","weight":20},{"code":"async function handleRequest(request) {\n  /**\n   * Best practice is to only assign new properties on the request\n   * object (i.e. RequestInit props) through either a method or the constructor\n   */\n  let newRequestInit = {\n    // Change method\n    method: 'POST',\n    // Change body\n    body: JSON.stringify({ bar: 'foo' }),\n    // Change the redirect mode.\n    redirect: 'follow',\n    //Change headers, note this method will erase existing headers\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    // Change a Cloudflare feature on the outbound response\n    cf: { apps: false },\n  }\n  // Change URL\n  let url = someUrl\n  // Change just the host\n  url = new URL(url)\n  url.hostname = someHost\n  // Best practice is to always use the original request to construct the new request\n  // thereby cloning all the attributes, applying the URL also requires a constructor\n  // since once a Request has been constructed, its URL is immutable.\n  const newRequest = new Request(url, new Request(request, newRequestInit))\n  // Set headers using method\n  newRequest.headers.set('X-Example', 'bar')\n  newRequest.headers.set('Content-Type', 'application/json')\n  try {\n    return await fetch(newRequest)\n  } catch (e) {\n    return new Response(JSON.stringify({ error: e.message }), { status: 500 })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Example someHost is set up to return raw JSON\n * @param {string} someUrl the URL to send the request to, since we are setting hostname too only path is applied\n * @param {string} someHost the host the request will resolve too\n */\nconst someHost = 'example.com'\nconst someUrl = 'https://foo.example.com/api.js'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#27b91145f66b6cfce1b3190ed7ba0bc5:https://example.com"}},"description":"Recommended practice for forming a [request](/reference/apis/request) based off the incoming request. First, takes in the incoming request then modifies specific properties like POST `body`, `redirect`, and the Cloudflare specific property `cf` and runs the fetch.","id":"modify_req_props","share_url":"/templates/snippets/modify_req_props","title":"Modify Request Property","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  // If request is for test.css just serve the raw CSS\n  if (/test.css$/.test(request.url)) {\n    return new Response(CSS, {\n      headers: {\n        'content-type': 'text/css',\n      },\n    })\n  } else {\n    // serve raw HTML using HTTP/2 for the CSS file\n    return new Response(HTML, {\n      headers: {\n        'content-type': 'text/html',\n        Link: '\u003c/http2_push/h2p/test.css\u003e; rel=preload;',\n      },\n    })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\nconst CSS = `body { color: red; }`\nconst HTML = `\n\u003c!doctype html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003cmeta charset=\"utf-8\"\u003e\n    \u003ctitle\u003eServer push test\u003c/title\u003e\n    \u003clink rel=\"stylesheet\" href=\"http2_push/h2p/test.css\"\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003ch1\u003eServer push test page\u003c/h1\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n`\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#f7b7e99bec493ba4f4847a095c4fa61c:https://tutorial.cloudflareworkers.com/"}},"description":"Push static assests to a client's browser without waiting for HTML to render","id":"http2_server_push","title":"HTTP/2 Server Push","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  let url = new URL(request.url)\n  // Check if incoming hostname is\n  // a key in the ORIGINS object\n  let target = ORIGINS[url.hostname]\n  // If it is, proxy request to that third party origin\n  if (target) {\n    url.hostname = target\n    return fetch(url, request)\n  }\n  // Otherwise, process request as normal\n  return fetch(request)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * An object with different url's to fetch\n * @param {Object} ORIGINS\n */\nconst ORIGINS = {\n  'starwarsapi.yourdomain.com': 'swapi.co',\n  'google.yourdomain.com': 'google.com',\n}\n","demos":{"main":{"share_url":"/templates/snippets/bulk_origin_proxies","text":"Demo","url":"https://cloudflareworkers.com/#545c79e098708ca658dcbdb860c5021a:https://starwarsapi.yourdomain.com/"}},"description":"Resolve requests to your domain to a set of proxy third-party origins","id":"bulk_origin_proxies","title":"Bulk Origin Proxies","type":"snippet","weight":1},{"code":"// NOTE Requires ESM through webpack project type\nconst crypto = require('crypto')\nconst SECRET = 'SECRET_KEY'\nasync function handleRequest(request) {\n  let signed = await checkSignature(request)\n  if (signed) {\n    let responseBody = 'Hello worker!'\n    return await signResponse(responseBody, new Response(responseBody))\n  } else {\n    return new Response('Request not signed', { status: 400 })\n  }\n}\naddEventListener('fetch', event =\u003e {\n  console.log(createHexSignature('asd'))\n  event.respondWith(handleRequest(event.request))\n})\nasync function createHexSignature(requestBody) {\n  let hmac = crypto.createHmac('sha256', SECRET)\n  hmac.update(requestBody)\n  return hmac.digest('hex')\n}\nasync function checkSignature(request) {\n  // hash request with secret key\n  let expectedSignature = await createHexSignature(await request.text())\n  let actualSignature = await request.headers.get('signature')\n  // check that hash matches signature\n  return expectedSignature === actualSignature\n}\nasync function signResponse(responseBody, response) {\n  // create signature\n  const signature = await createHexSignature(responseBody)\n  response.headers.set('signature', signature)\n  //add header with signature\n  return response\n}\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/?hide_editor#c22ea0102fb9dced927a9b870e9c546a:https://example.com/"}},"description":"Check signatures of requests and sign responses with a private key","id":"signed_request","share_url":"/templates/snippets/signed_request","title":"Signed Request/Response","type":"snippet","weight":10},{"demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://serve-binjs.that-test.site/"}},"description":"Serve BinAST via a Cloudflare Worker","id":"binast_cf_worker","repository_url":"https://github.com/xtuc/binast-cf-worker-template","title":"Binast-Cf-Worker","type":"featured_boilerplate","weight":1},{"description":"Simple Hello World in TypeScript","id":"typescript","repository_url":"https://github.com/EverlastingBugstopper/worker-typescript-template","tags":["Originless"],"title":"Hello World TypeScript","type":"boilerplate","weight":90},{"description":"Retrieve the dominant color of a PNG or JPEG image","id":"img_color_worker","repository_url":"https://github.com/xtuc/img-color-worker","tags":["Middleware"],"title":"Img-Color-Worker","type":"featured_boilerplate","weight":1},{"code":"async function handleRequest(request) {\n  let requestURL = new URL(request.url)\n  let path = requestURL.pathname.split('/redirect')[1]\n  let location = redirectMap.get(path)\n  if (location) {\n    return Response.redirect(location, 301)\n  }\n  // If in map, return the original request\n  return fetch(request)\n}\naddEventListener('fetch', async event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\nconst externalHostname = 'workers-tooling.cf'\nconst redirectMap = new Map([\n  ['/bulk1', 'https://' + externalHostname + '/redirect2'],\n  ['/bulk2', 'https://' + externalHostname + '/redirect3'],\n  ['/bulk3', 'https://' + externalHostname + '/redirect4'],\n  ['/bulk4', 'https://google.com'],\n])\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#d17c3da192fd5c83ef7d28153ab32f3f:https://example.com/redirect/bulk1"}},"description":"Redirects requests to certain URLs based a mapped object to the request's URL.","id":"bulk_redirects","title":"Bulk Redirects","type":"snippet","weight":1},{"description":"Serve private AWS bucket files from a Worker script","id":"cloud_storage","repository_url":"https://github.com/conzorkingkong/cloud-storage","share_url":"/templates/featured_boilerplates/cloud_storage","tags":["Middleware"],"title":"Cloud Storage","type":"featured_boilerplate","weight":50},{"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': type,\n    },\n  }\n  const responses = await Promise.all([fetch(url1, init), fetch(url2, init)])\n  const results = await Promise.all([gatherResponse(responses[0]), gatherResponse(responses[1])])\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost is set up to return JSON responses\n * Replace url1 and url2  with the hosts you wish to\n * send requests to\n * @param {string} url the URL to send the request to\n */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url1 = someHost + '/requests/json'\nconst url2 = someHost + '/requests/json'\nconst type = 'application/json;charset=UTF-8'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#eaaa52283784c21aec989c64b9db32d3:https://example.com"}},"description":"Sends two GET request to two urls and aggregates the responses into one response.","id":"aggregate_requests","share_url":"/templates/snippets/aggregate_requests","title":"Aggregate Requests","type":"snippet","weight":20},{"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': 'text/html;charset=UTF-8',\n    },\n  }\n  return new Response(someHTML, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\nconst someHTML =  `\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n  \u003cbody\u003e\n  \u003ch1\u003eHello World\u003c/h1\u003e\n  \u003cp\u003eThis is all generated using a Worker\u003c/p\u003e\n  \u003ciframe\n      width=\"560\"\n      height=\"315\"\n      src=\"https://www.youtube.com/embed/dQw4w9WgXcQ\"\n      frameborder=\"0\"\n      allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n      allowfullscreen\n  \u003e\u003c/iframe\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n`\n","demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#ba06ef26637ab98b1f38a18dc527dc69:https://example.com"}},"description":"Delivers an HTML page from HTML directly in the Worker script.","id":"send_raw_html","share_url":"/templates/snippets/send_raw_html","title":"Send Raw HTML","type":"snippet","weight":1},{"code":"const OLD_URL = 'developer.mozilla.org'\nconst NEW_URL = 'mynewdomain.com'\n\nasync function handleRequest(req) {\n  const res = await fetch(req)\n  return rewriter.transform(res)\n}\n\nclass AttributeRewriter {\n  constructor(attributeName) {\n    this.attributeName = attributeName\n  }\n\n  element(element) {\n    const attribute = element.getAttribute(this.attributeName)\n    if (attribute) {\n      element.setAttribute(\n        this.attributeName,\n        attribute.replace(OLD_URL, NEW_URL),\n      )\n    }\n  }\n}\n\nconst rewriter = new HTMLRewriter()\n  .on('a', new AttributeRewriter('href'))\n  .on('img', new AttributeRewriter('src'))\n\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","description":"Rewrite URL links in HTML using [HTML Rewriter](/reference/apis/html-rewriter)","id":"rewrite_links_html","title":"Rewrite links in HTML","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  const init = {\n    body: JSON.stringify(body),\n    method: 'POST',\n    headers: {\n      'content-type': 'application/json;charset=UTF-8',\n    },\n  }\n  const response = await fetch(url, init)\n  const results = await gatherResponse(response)\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost is set up to take in a JSON request\n * Replace url with the host you wish to send requests to\n * @param {string} url the URL to send the request to\n * @param {BodyInit} body the JSON data to send in the request\n */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url = someHost + '/requests/json'\nconst body = {\n  results: ['default data to send'],\n  errors: null,\n  msg: 'I sent this to the fetch',\n}\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#edce60b7d57c1e98fbe2d931aaaaf25f:https://tutorial.cloudflareworkers.com"}},"description":"Sends a POST request with JSON data from the Workers script.","id":"post_json","title":"Post JSON","type":"snippet","weight":1},{"demos":{"bar":{"text":"Demo /bar","url":"https://cloudflareworkers.com/#6cbbd3ae7d4e928da3502cb9ce11227a:https://tutorial.cloudflareworkers.com/bar"},"foo":{"text":"Demo /foo","url":"https://cloudflareworkers.com/#6cbbd3ae7d4e928da3502cb9ce11227a:https://tutorial.cloudflareworkers.com/foo"}},"description":"Selects the logic based on the `request` method and URL. Use with REST APIs or apps that require routing logic.","id":"router","repository_url":"https://github.com/cloudflare/worker-template-router","share_url":"/templates/boilerplates/router","title":"Router","type":"boilerplate","url":"/templates/boilerplates/router","weight":97},{"description":"Get started with Workers Sites to easily deploy static assets to the Cloudflare edge.","id":"sites","repository_url":"https://github.com/cloudflare/worker-sites-template","share_url":"/sites/start-from-scratch","tags":["Originless"],"title":"Worker Sites","type":"featured_boilerplate","weight":1},{"demos":{"main":{"text":"Demo","url":"https://workers-graphql.signalnerve.workers.dev/___graphql"}},"description":"ðŸ”¥Lightning-fast, globally distributed Apollo GraphQL server, deployed at the edge using Cloudflare Workers.","id":"graphql_server","repository_url":"https://github.com/signalnerve/workers-graphql-server","share_url":"/templates/featured_boilerplates/graphql","title":"Apollo GraphQL Server","type":"featured_boilerplate","weight":2},{"code":"const COOKIE_NAME = '__uid'\nasync function handleRequest(request) {\n  const cookie = getCookie(request, COOKIE_NAME)\n  if (cookie) {\n    // respond with the cookie value\n    return new Response(cookie)\n  }\n  return new Response('No cookie with name: ' + COOKIE_NAME)\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Grabs the cookie with name from the request headers\n * @param {Request} request incoming Request\n * @param {string} name of the cookie to grab\n */\nfunction getCookie(request, name) {\n  let result = null\n  let cookieString = request.headers.get('Cookie')\n  if (cookieString) {\n    let cookies = cookieString.split(';')\n    cookies.forEach(cookie =\u003e {\n      let cookieName = cookie.split('=')[0].trim()\n      if (cookieName === name) {\n        let cookieVal = cookie.split('=')[1]\n        result = cookieVal\n      }\n    })\n  }\n  return result\n}\n","demos":{"main":{"share_url":"/templates/snippets/cookie_extract","text":"Demo","url":"https://cloudflareworkers.com/#605946f0f09b396361d3dadb5abf29c8:https://tutorial.cloudflareworkers.com/"}},"description":"Extracts the value of a cookie, given the cookie name.","id":"cookie_extract","title":"Extract Cookie Value","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': 'application/json;charset=UTF-8',\n    },\n  }\n  return new Response(JSON.stringify(someJSON), init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\nconst someJSON = {\n  result: ['some', 'results'],\n  errors: null,\n  msg: 'this is some random json',\n}\n","demos":{"main":{"tags":["Originless"],"text":"Demo","url":"https://cloudflareworkers.com/#83bc6debecf1dd443d3fabfbde0d2b3a:https://example.com"}},"description":"Renders a response of type `application/json` to the client","id":"send_raw_json","title":"Send Raw JSON","type":"snippet","weight":50},{"code":"async function handleRequest(event) {\n  let request = event.request\n  let cacheUrl = new URL(request.url)\n  // hostname for a different zone\n  cacheUrl.hostname = someOtherHostname\n  let cacheKey = new Request(cacheUrl, request)\n  let cache = caches.default\n  // Get this request from this zone's cache\n  let response = await cache.match(cacheKey)\n  if (!response) {\n    //if not in cache, grab it from the origin\n    response = await fetch(request)\n    // must use Response constructor to inherit all of response's fields\n    response = new Response(response.body, response)\n    // Cache API respects Cache-Control headers, so by setting max-age to 10\n    // the response will only live in cache for max of 10 seconds\n    response.headers.append('Cache-Control', 'max-age=10')\n    // store the fetched response as cacheKey\n    // use waitUntil so computational expensive tasks don't delay the response\n    event.waitUntil(cache.put(cacheKey, response.clone()))\n  }\n  return response\n}\nasync function handlePostRequest(event) {\n  let request = event.request\n  let body = await request.clone().text()\n  let hash = await sha256(body)\n  let cacheUrl = new URL(request.url)\n  // get/store the URL in cache by prepending the body's hash\n  cacheUrl.pathname = '/posts' + cacheUrl.pathname + hash\n  // Convert to a GET to be able to cache\n  let cacheKey = new Request(cacheUrl, {\n    headers: request.headers,\n    method: 'GET',\n  })\n  let cache = caches.default\n  //try to find the cache key in the cache\n  let response = await cache.match(cacheKey)\n  // otherwise, fetch response to POST request from origin\n  if (!response) {\n    response = await fetch(request)\n    event.waitUntil(cache.put(cacheKey, response))\n  }\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  try {\n    let request = event.request\n    if (request.method.toUpperCase() === 'POST')\n      return event.respondWith(handlePostRequest(event))\n    return event.respondWith(handleRequest(event))\n  } catch (e) {\n    return event.respondWith(new Response('Error thrown ' + e.message))\n  }\n})\nasync function sha256(message) {\n  // encode as UTF-8\n  const msgBuffer = new TextEncoder().encode(message)\n  // hash the message\n  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer)\n  // convert ArrayBuffer to Array\n  const hashArray = Array.from(new Uint8Array(hashBuffer))\n  // convert bytes to hex string\n  const hashHex = hashArray.map(b =\u003e ('00' + b.toString(16)).slice(-2)).join('')\n  return hashHex\n}\nconst someOtherHostname = 'my.herokuapp.com'\n","description":"Cache using Cloudflare's [Cache API](/reference/apis/cache/). This example can cache POST requests as well as change what hostname to store a response in cache. Note the previewer is not avalible for using Cache API.","id":"cache_api","tags":["Middleware"],"title":"Cache API","type":"snippet","weight":1},{"demos":{"main":{"share_url":"/templates/boilerplates/rustwasm","tags":["Originless","Wasm"],"text":"Demo","url":"https://cloudflareworkers.com/#1992963c14c25bc8dc4c50f4cab740e5:https://tutorial.cloudflareworkers.com"}},"description":"Simple Hello World in Rust","id":"hello_world_rust","repository_url":"https://github.com/cloudflare/rustwasm-worker-template","title":"Hello World Rust","type":"boilerplate","weight":98},{"description":"Log exceptions and errors in your Workers application to Sentry.io -  an error tracking tool","id":"sentry","repository_url":"https://github.com/bustle/cf-sentry","tags":["Middleware"],"title":"Sentry","type":"featured_boilerplate","weight":1},{"code":"async function handleRequest(request) {\n  const init = {\n    headers: {\n      'content-type': type,\n    },\n  }\n  const responses = await Promise.all([fetch(url1, init), fetch(url2, init)])\n  const results = await Promise.all([gatherResponse(responses[0]), gatherResponse(responses[1])])\n  return new Response(results, init)\n}\naddEventListener('fetch', event =\u003e {\n  return event.respondWith(handleRequest(event.request))\n})\n/**\n * gatherResponse awaits and returns a response body as a string.\n * Use await gatherResponse(..) in an async function to get the response body\n * @param {Response} response\n */\nasync function gatherResponse(response) {\n  const { headers } = response\n  const contentType = headers.get('content-type')\n  if (contentType.includes('application/json')) {\n    return await response.json()\n  } else if (contentType.includes('application/text')) {\n    return await response.text()\n  } else if (contentType.includes('text/html')) {\n    return await response.text()\n  } else {\n    return await response.text()\n  }\n}\n/**\n * Example someHost is set up to return JSON responses\n * Replace url1 and url2  with the hosts you wish to\n * send requests to\n * @param {string} url the URL to send the request to\n */\nconst someHost = 'https://workers-tooling.cf/demos'\nconst url1 = someHost + '/requests/json'\nconst url2 = someHost + '/requests/json'\nconst type = 'application/json;charset=UTF-8'\n","demos":{"main":{"tags":["Middleware"],"text":"Demo","url":"https://cloudflareworkers.com/#a45261f6682b048d9ed0e23a330d9cdb:https://example.com"}},"description":"Sends a GET request and reads in JSON from the response.","id":"fetch_json","title":"Fetch JSON","type":"snippet","weight":30},{"code":"async function handleRequest(request) {\n  // Make the headers mutable by re-constructing the Request.\n  request = new Request(request)\n  request.headers.set('x-my-header', 'custom value')\n  const URL = 'https://workers-tooling.cf/demos/static/html'\n  // URL is set up to respond with dummy HTML, remove to send requests to your own origin\n  let response = await fetch(URL, request)\n  // Make the headers mutable by re-constructing the Response.\n  response = new Response(response.body, response)\n  response.headers.set('x-my-header', 'custom value')\n  return response\n}\naddEventListener('fetch', event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n","demos":{"main":{"share_url":"/templates/snippets/alter_headers","text":"Demo","url":"https://cloudflareworkers.com/#5386d315ec8c899370e8e5d00cf88939:https://tutorial.cloudflareworkers.com"}},"description":"Change the headers sent in a request or returned in a response","id":"alter_headers","title":"Alter Headers","type":"snippet","weight":1},{"code":"async function handleRequest(request) {\n  return Response.redirect(someURLToRedirectTo, code)\n}\naddEventListener('fetch', async event =\u003e {\n  event.respondWith(handleRequest(event.request))\n})\n/**\n * Example Input\n * @param {Request} url where to redirect the response\n * @param {number?=301|302} type permanent or temporary redirect\n */\nconst someURLToRedirectTo = 'https://www.google.com'\nconst code = 301\n","demos":{"main":{"text":"Demo","url":"https://cloudflareworkers.com/#ab385d4c4e43608684889eaa390d4218:https://example.com/"}},"description":"Redirect a request by sending a 301 or 302 HTTP response","id":"redirect","title":"Redirect","type":"snippet","weight":1}]
  </script>
</div>

<p>The gallery is actively growing. The <a href="https://github.com/victoriabernard92/workers-template-creator">template creator</a> allows you to share templates. Host a public repo, and then run <code>wrangler generate <a href="https://github.com/">https://github.com/</a><your-repo></code>.</p>

<p>For archived recipes, see <a href="https://developers.cloudflare.com/workers/recipes/">the old docs</a>.</p>

<p></div></p>

<script src="https://unpkg.com/lunr/lunr.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.15/lodash.min.js" integrity="sha256-VeNaFBVDhoX3H+gJ37DpT/nTuZTdjYro9yBruHjVmoQ=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="https://developers.cloudflare.com/workers/js/templates.js"></script>

    </div>
  </div>
  <div id="navigation">
    
    

    <div class="footer-pagination">
      
      
    </div>
  </div>
</section>


    
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-107218623-2"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-107218623-2');
      </script>

      <script type="text/javascript">
        window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty","resetIdentity"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("3538148622");
      </script>
    
  </body>
</html>